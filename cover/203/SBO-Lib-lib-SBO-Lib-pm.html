<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!--
This file was generated by Devel::Cover Version 1.21
Devel::Cover is copyright 2001-2012, Paul Johnson (paul@pjcj.net)
Devel::Cover is free. It is licensed under the same terms as Perl itself.
The latest version of Devel::Cover should be available from my homepage:
http://www.pjcj.net
-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
    <meta http-equiv="Content-Language" content="en-us"></meta>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <title>File Coverage: SBO-Lib/lib/SBO/Lib.pm</title>
</head>
<body>
<h1>File Coverage</h1>
<table>
<tr><td class="h" align="right">File:</td><td align="left">SBO-Lib/lib/SBO/Lib.pm</td></tr>
<tr><td class="h" align="right">Coverage:</td><td align="left" class="c1">81.5%</td></tr>
</table>
<div><br/></div>
<table>
<tr><th>line</th><th>stmt</th><th>bran</th><th>cond</th><th>sub</th><th>code</th></tr>
<tr><td class="h">1</td><td></td><td></td><td></td><td></td><td class="s">#!/usr/bin/env perl</td></tr>
<tr><td class="h">2</td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">3</td><td></td><td></td><td></td><td></td><td class="s"># vim: set ts=4:noet</td></tr>
<tr><td class="h">4</td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">5</td><td></td><td></td><td></td><td></td><td class="s"># Lib.pm</td></tr>
<tr><td class="h">6</td><td></td><td></td><td></td><td></td><td class="s"># shared functions for the sbo_ scripts.</td></tr>
<tr><td class="h">7</td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">8</td><td></td><td></td><td></td><td></td><td class="s"># authors:&nbsp;&nbsp;Jacob Pipkin &lt;j@dawnrazor.net&gt;</td></tr>
<tr><td class="h">9</td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Luke Williams &lt;xocel@iquidus.org&gt;</td></tr>
<tr><td class="h">10</td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Andreas Guldstrand &lt;andreas.guldstrand@gmail.com&gt;</td></tr>
<tr><td class="h">11</td><td></td><td></td><td></td><td></td><td class="s"># license: WTFPL &lt;http://sam.zoy.org/wtfpl/COPYING&gt;</td></tr>
<tr><td class="h">12</td><td colspan="5"></td></tr><tr><td class="h">13</td><td></td><td></td><td></td><td></td><td class="s">use 5.16.0;</td></tr>
<tr><td class="h">14</td><td></td><td></td><td></td><td></td><td class="s">use strict;</td></tr>
<tr><td class="h">15</td><td></td><td></td><td></td><td></td><td class="s">use warnings FATAL =&gt; &#39;all&#39;;</td></tr>
<tr><td class="h">16</td><td colspan="5"></td></tr><tr><td class="h">17</td><td></td><td></td><td></td><td></td><td class="s">package SBO::Lib;</td></tr>
<tr><td class="h">18</td><td></td><td></td><td></td><td></td><td class="s">our $VERSION = &#39;2.0&#39;;</td></tr>
<tr><td class="h">19</td><td colspan="5"></td></tr><tr><td class="h">20</td><td></td><td></td><td></td><td></td><td class="s">use Exporter &#39;import&#39;;</td></tr>
<tr><td class="h">21</td><td colspan="5"></td></tr><tr><td class="h">22</td><td></td><td></td><td></td><td></td><td class="s">our @EXPORT_OK = qw(</td></tr>
<tr><td class="h">23</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;script_error</td></tr>
<tr><td class="h">24</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;open_fh</td></tr>
<tr><td class="h">25</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;open_read</td></tr>
<tr><td class="h">26</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;show_version</td></tr>
<tr><td class="h">27</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;slackbuilds_or_fetch</td></tr>
<tr><td class="h">28</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fetch_tree</td></tr>
<tr><td class="h">29</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;update_tree</td></tr>
<tr><td class="h">30</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get_installed_packages</td></tr>
<tr><td class="h">31</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get_inst_names</td></tr>
<tr><td class="h">32</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get_available_updates</td></tr>
<tr><td class="h">33</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get_requires</td></tr>
<tr><td class="h">34</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get_readme_contents</td></tr>
<tr><td class="h">35</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do_slackbuild</td></tr>
<tr><td class="h">36</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;make_clean</td></tr>
<tr><td class="h">37</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;make_distclean</td></tr>
<tr><td class="h">38</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do_upgradepkg</td></tr>
<tr><td class="h">39</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get_sbo_location</td></tr>
<tr><td class="h">40</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get_sbo_locations</td></tr>
<tr><td class="h">41</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get_from_info</td></tr>
<tr><td class="h">42</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get_tmp_extfn</td></tr>
<tr><td class="h">43</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get_arch</td></tr>
<tr><td class="h">44</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get_build_queue</td></tr>
<tr><td class="h">45</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;merge_queues</td></tr>
<tr><td class="h">46</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get_installed_cpans</td></tr>
<tr><td class="h">47</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;check_distfiles</td></tr>
<tr><td class="h">48</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get_user_group</td></tr>
<tr><td class="h">49</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ask_user_group</td></tr>
<tr><td class="h">50</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get_opts</td></tr>
<tr><td class="h">51</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ask_opts</td></tr>
<tr><td class="h">52</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_prompt</td></tr>
<tr><td class="h">53</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;process_sbos</td></tr>
<tr><td class="h">54</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print_failures</td></tr>
<tr><td class="h">55</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;usage_error</td></tr>
<tr><td class="h">56</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uniq</td></tr>
<tr><td class="h">57</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is_local</td></tr>
<tr><td class="h">58</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get_orig_location</td></tr>
<tr><td class="h">59</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get_orig_version</td></tr>
<tr><td class="h">60</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get_local_outdated_versions</td></tr>
<tr><td class="h">61</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in</td></tr>
<tr><td class="h">62</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tempdir</td></tr>
<tr><td class="h">63</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conf_dir</td></tr>
<tr><td class="h">64</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conf_file</td></tr>
<tr><td class="h">65</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%config</td></tr>
<tr><td class="h">66</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$slackbuilds_txt</td></tr>
<tr><td class="h">67</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$repo_path</td></tr>
<tr><td class="h">68</td><td></td><td></td><td></td><td></td><td class="s">);</td></tr>
<tr><td class="h">69</td><td colspan="5"></td></tr><tr><td class="h">70</td><td></td><td></td><td></td><td></td><td class="s">our %EXPORT_TAGS = (</td></tr>
<tr><td class="h">71</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;all =&gt; \@EXPORT_OK,</td></tr>
<tr><td class="h">72</td><td></td><td></td><td></td><td></td><td class="s">);</td></tr>
<tr><td class="h">73</td><td colspan="5"></td></tr><tr><td class="h">74</td><td></td><td></td><td></td><td></td><td class="s">use constant {</td></tr>
<tr><td class="h">75</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_ERR_USAGE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 1,&nbsp;&nbsp;&nbsp;# usage errors</td></tr>
<tr><td class="h">76</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_ERR_SCRIPT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 2,&nbsp;&nbsp;&nbsp;# errors with the scripts themselves</td></tr>
<tr><td class="h">77</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_ERR_BUILD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 3,&nbsp;&nbsp;&nbsp;# errors during the slackbuild process</td></tr>
<tr><td class="h">78</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_ERR_MD5SUM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 4,&nbsp;&nbsp;&nbsp;# md5sum verification</td></tr>
<tr><td class="h">79</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_ERR_DOWNLOAD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 5,&nbsp;&nbsp;&nbsp;# errors with downloading things</td></tr>
<tr><td class="h">80</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_ERR_OPENFH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 6,&nbsp;&nbsp;&nbsp;# opening file handles</td></tr>
<tr><td class="h">81</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_ERR_NOINFO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 7,&nbsp;&nbsp;&nbsp;# missing information</td></tr>
<tr><td class="h">82</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_ERR_F_SETFD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 8,&nbsp;&nbsp;&nbsp;# unsetting exec-on-close bit</td></tr>
<tr><td class="h">83</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_ERR_NOMULTILIB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 9,&nbsp;&nbsp;&nbsp;# lacking multilib where required</td></tr>
<tr><td class="h">84</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_ERR_CONVERTPKG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 10,&nbsp;&nbsp;# errors while running convertpkg-compat32</td></tr>
<tr><td class="h">85</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_ERR_NOCONVERTPKG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 11,&nbsp;&nbsp;# lacking convertpkg-compat32 where required</td></tr>
<tr><td class="h">86</td><td></td><td></td><td></td><td></td><td class="s">};</td></tr>
<tr><td class="h">87</td><td colspan="5"></td></tr><tr><td class="h">88</td><td></td><td></td><td></td><td></td><td class="s">unless ($&lt; == 0) {</td></tr>
<tr><td class="h">89</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;warn &quot;This script requires root privileges.\n&quot;;</td></tr>
<tr><td class="h">90</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit _ERR_USAGE;</td></tr>
<tr><td class="h">91</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">92</td><td colspan="5"></td></tr><tr><td class="h">93</td><td></td><td></td><td></td><td></td><td class="s">use Tie::File;</td></tr>
<tr><td class="h">94</td><td></td><td></td><td></td><td></td><td class="s">use Sort::Versions;</td></tr>
<tr><td class="h">95</td><td></td><td></td><td></td><td></td><td class="s">use Digest::MD5;</td></tr>
<tr><td class="h">96</td><td></td><td></td><td></td><td></td><td class="s">use File::Copy;</td></tr>
<tr><td class="h">97</td><td></td><td></td><td></td><td></td><td class="s">use File::Path qw(make_path remove_tree);</td></tr>
<tr><td class="h">98</td><td></td><td></td><td></td><td></td><td class="s">use File::Temp qw(tempdir tempfile);</td></tr>
<tr><td class="h">99</td><td></td><td></td><td></td><td></td><td class="s">use File::Find;</td></tr>
<tr><td class="h">100</td><td></td><td></td><td></td><td></td><td class="s">use File::Basename;</td></tr>
<tr><td class="h">101</td><td></td><td></td><td></td><td></td><td class="s">use Fcntl qw(F_SETFD F_GETFD);</td></tr>
<tr><td class="h">102</td><td></td><td></td><td></td><td></td><td class="s">use Cwd;</td></tr>
<tr><td class="h">103</td><td colspan="5"></td></tr><tr><td class="h">104</td><td><div class="c3">1530</div><div class="c3">1530</div></td><td></td><td></td><td><div class="c3"><a href="SBO-Lib-lib-SBO-Lib-pm--subroutine.html#L104">1530</a></div></td><td class="s"># get $TMP from the env, if defined - we use two variables here because there</td></tr>
<tr><td class="h">105</td><td></td><td></td><td></td><td></td><td class="s"># are times when we need to no if the environment variable is set, and other</td></tr>
<tr><td class="h">106</td><td></td><td></td><td></td><td></td><td class="s"># times where it doesn&#39;t matter.</td></tr>
<tr><td class="h">107</td><td></td><td></td><td></td><td></td><td class="s">our $env_tmp = $ENV{TMP};</td></tr>
<tr><td class="h">108</td><td></td><td></td><td></td><td></td><td class="s">our $tmpd = $env_tmp ? $env_tmp : &#39;/tmp/SBo&#39;;</td></tr>
<tr><td class="h">109</td><td></td><td></td><td></td><td></td><td class="s">make_path($tmpd) unless -d $tmpd;</td></tr>
<tr><td class="h">110</td><td colspan="5"></td></tr><tr><td class="h">111</td><td></td><td></td><td></td><td></td><td class="s">our $tempdir = tempdir(CLEANUP =&gt; 1, DIR =&gt; $tmpd);</td></tr>
<tr><td class="h">112</td><td colspan="5"></td></tr><tr><td class="h">113</td><td></td><td></td><td></td><td></td><td class="s"># define this to facilitate unit testing - should only ever be modified from</td></tr>
<tr><td class="h">114</td><td></td><td></td><td></td><td></td><td class="s"># t/01-test.t</td></tr>
<tr><td class="h">115</td><td></td><td></td><td></td><td></td><td class="s">our $pkg_db = &#39;/var/log/packages&#39;;</td></tr>
<tr><td class="h">116</td><td colspan="5"></td></tr><tr><td class="h">117</td><td></td><td></td><td></td><td></td><td class="s"># subroutine for throwing internal script errors</td></tr>
<tr><td class="h">118</td><td></td><td></td><td></td><td></td><td class="s">sub script_error {</td></tr>
<tr><td class="h">119</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_ &gt;= 1 ? warn &quot;A fatal script error has occurred:\n$_[0]\nExiting.\n&quot;</td></tr>
<tr><td class="h">120</td><td><div class="c3">1530</div><div class="c3">1530</div><div class="c3">1530</div></td><td></td><td></td><td><div class="c3"><a href="SBO-Lib-lib-SBO-Lib-pm--subroutine.html#L120">1530</a></div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: warn &quot;A fatal script error has occurred. Exiting.\n&quot;;</td></tr>
<tr><td class="h">121</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit _ERR_SCRIPT;</td></tr>
<tr><td class="h">122</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">123</td><td colspan="5"></td></tr><tr><td class="h">124</td><td></td><td></td><td></td><td></td><td class="s"># subroutine for usage errors</td></tr>
<tr><td class="h">125</td><td></td><td></td><td></td><td></td><td class="s">sub usage_error {</td></tr>
<tr><td class="h">126</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;warn shift .&quot;\n&quot;;</td></tr>
<tr><td class="h">127</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit _ERR_USAGE;</td></tr>
<tr><td class="h">128</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">129</td><td colspan="5"></td></tr><tr><td class="h">130</td><td></td><td></td><td></td><td></td><td class="s"># sub for opening files, second arg is like &#39;&lt;&#39;,&#39;&gt;&#39;, etc</td></tr>
<tr><td class="h">131</td><td></td><td></td><td></td><td></td><td class="s">sub open_fh {</td></tr>
<tr><td class="h">132</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_ == 2 or script_error &#39;open_fh requires two arguments&#39;;</td></tr>
<tr><td class="h">133</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless ($_[1] eq &#39;&gt;&#39;) {</td></tr>
<tr><td class="h">134</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-f $_[0] or script_error &quot;open_fh, $_[0] is not a file&quot;;</td></tr>
<tr><td class="h">135</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">136</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($file, $op) = @_;</td></tr>
<tr><td class="h">137</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $fh;</td></tr>
<tr><td class="h">138</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless (open $fh, $op, $file) {</td></tr>
<tr><td class="h">139</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $warn = &quot;Unable to open $file.\n&quot;;</td></tr>
<tr><td class="h">140</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $exit = _ERR_OPENFH;</td></tr>
<tr><td class="h">141</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return ($warn, $exit);</td></tr>
<tr><td class="h">142</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">143</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $fh;</td></tr>
<tr><td class="h">144</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">145</td><td colspan="5"></td></tr><tr><td class="h">146</td><td></td><td></td><td></td><td></td><td class="s">sub open_read {</td></tr>
<tr><td class="h">147</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return open_fh(shift, &#39;&lt;&#39;);</td></tr>
<tr><td class="h">148</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">149</td><td colspan="5"></td></tr><tr><td class="h">150</td><td></td><td></td><td></td><td></td><td class="s"># global config variables</td></tr>
<tr><td class="h">151</td><td></td><td></td><td></td><td></td><td class="s">our $conf_dir = &#39;/etc/sbotools&#39;;</td></tr>
<tr><td class="h">152</td><td></td><td></td><td></td><td></td><td class="s">our $conf_file = &quot;$conf_dir/sbotools.conf&quot;;</td></tr>
<tr><td class="h">153</td><td></td><td></td><td></td><td></td><td class="s">our %config = (</td></tr>
<tr><td class="h">154</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NOCLEAN =&gt; &#39;FALSE&#39;,</td></tr>
<tr><td class="h">155</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DISTCLEAN =&gt; &#39;FALSE&#39;,</td></tr>
<tr><td class="h">156</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JOBS =&gt; &#39;FALSE&#39;,</td></tr>
<tr><td class="h">157</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PKG_DIR =&gt; &#39;FALSE&#39;,</td></tr>
<tr><td class="h">158</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SBO_HOME =&gt; &#39;FALSE&#39;,</td></tr>
<tr><td class="h">159</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOCAL_OVERRIDES =&gt; &#39;FALSE&#39;,</td></tr>
<tr><td class="h">160</td><td><div class="c3">1530</div><div class="c3">1530</div><div class="c3">1530</div></td><td></td><td></td><td><div class="c3"><a href="SBO-Lib-lib-SBO-Lib-pm--subroutine.html#L160">1530</a></div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SLACKWARE_VERSION =&gt; &#39;FALSE&#39;,</td></tr>
<tr><td class="h">161</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REPO =&gt; &#39;FALSE&#39;,</td></tr>
<tr><td class="h">162</td><td></td><td></td><td></td><td></td><td class="s">);</td></tr>
<tr><td class="h">163</td><td colspan="5"></td></tr><tr><td class="h">164</td><td></td><td></td><td></td><td></td><td class="s"># subroutine to suck in config in order to facilitate unit testing</td></tr>
<tr><td class="h">165</td><td></td><td></td><td></td><td></td><td class="s">sub read_config {</td></tr>
<tr><td class="h">166</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my %conf_values;</td></tr>
<tr><td class="h">167</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (-f $conf_file) {</td></tr>
<tr><td class="h">168</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($fh, $exit) = open_read $conf_file;</td></tr>
<tr><td class="h">169</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($exit) {</td></tr>
<tr><td class="h">170</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;warn $fh;</td></tr>
<tr><td class="h">171</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$config{SBO_HOME} = &#39;/usr/sbo&#39;;</td></tr>
<tr><td class="h">172</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</td></tr>
<tr><td class="h">173</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">174</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $text = do {local $/; &lt;$fh&gt;};</td></tr>
<tr><td class="h">175</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%conf_values = $text =~ /^(\w+)=(.*)$/mg;</td></tr>
<tr><td class="h">176</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close $fh;</td></tr>
<tr><td class="h">177</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">178</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for my $key (keys %config) {</td></tr>
<tr><td class="h">179</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$config{$key} = $conf_values{$key} if exists $conf_values{$key};</td></tr>
<tr><td class="h">180</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">181</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$config{JOBS} = &#39;FALSE&#39; unless $config{JOBS} =~ /^\d+$/;</td></tr>
<tr><td class="h">182</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$config{SBO_HOME} = &#39;/usr/sbo&#39; if $config{SBO_HOME} eq &#39;FALSE&#39;;</td></tr>
<tr><td class="h">183</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">184</td><td colspan="5"></td></tr><tr><td class="h">185</td><td></td><td></td><td></td><td></td><td class="s">read_config();</td></tr>
<tr><td class="h">186</td><td colspan="5"></td></tr><tr><td class="h">187</td><td></td><td></td><td></td><td></td><td class="s"># some stuff we&#39;ll need later - define first two as our for unit testing</td></tr>
<tr><td class="h">188</td><td></td><td></td><td></td><td></td><td class="s">our $distfiles = &quot;$config{SBO_HOME}/distfiles&quot;;</td></tr>
<tr><td class="h">189</td><td></td><td></td><td></td><td></td><td class="s">our $repo_path = &quot;$config{SBO_HOME}/repo&quot;;</td></tr>
<tr><td class="h">190</td><td></td><td></td><td></td><td></td><td class="s">our $slackbuilds_txt = &quot;$repo_path/SLACKBUILDS.TXT&quot;;</td></tr>
<tr><td class="h">191</td><td></td><td></td><td></td><td></td><td class="s">my $name_regex = &#39;\ASLACKBUILD\s+NAME:\s+&#39;;</td></tr>
<tr><td class="h">192</td><td colspan="5"></td></tr><tr><td class="h">193</td><td></td><td></td><td></td><td></td><td class="s">sub show_version {</td></tr>
<tr><td class="h">194</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;say &quot;sbotools version $VERSION&quot;;</td></tr>
<tr><td class="h">195</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;say &#39;licensed under the WTFPL&#39;;</td></tr>
<tr><td class="h">196</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;say &#39;&lt;http://sam.zoy.org/wtfpl/COPYING&gt;&#39;;</td></tr>
<tr><td class="h">197</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">198</td><td colspan="5"></td></tr><tr><td class="h">199</td><td></td><td></td><td></td><td></td><td class="s"># %supported maps what&#39;s in /etc/slackware-version to what&#39;s at SBo</td></tr>
<tr><td class="h">200</td><td></td><td></td><td></td><td></td><td class="s"># which is now not needed since this version drops support &lt; 14.0</td></tr>
<tr><td class="h">201</td><td></td><td></td><td></td><td></td><td class="s"># but it&#39;s already future-proofed, so leave it.</td></tr>
<tr><td class="h">202</td><td></td><td></td><td></td><td></td><td class="s">sub get_slack_version {</td></tr>
<tr><td class="h">203</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $config{SLACKWARE_VERSION} unless $config{SLACKWARE_VERSION} eq &#39;FALSE&#39;;</td></tr>
<tr><td class="h">204</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my %supported = (</td></tr>
<tr><td class="h">205</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;14.0&#39; =&gt; &#39;14.0&#39;,</td></tr>
<tr><td class="h">206</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;14.1&#39; =&gt; &#39;14.1&#39;,</td></tr>
<tr><td class="h">207</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">208</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($fh, $exit) = open_read(&#39;/etc/slackware-version&#39;);</td></tr>
<tr><td class="h">209</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($exit) {</td></tr>
<tr><td class="h">210</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;warn $fh;</td></tr>
<tr><td class="h">211</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit $exit;</td></tr>
<tr><td class="h">212</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">213</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chomp(my $line = &lt;$fh&gt;);</td></tr>
<tr><td class="h">214</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close $fh;</td></tr>
<tr><td class="h">215</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $version = ($line =~ /\s+(\d+[^\s]+)$/)[0];</td></tr>
<tr><td class="h">216</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;usage_error(&quot;Unsupported Slackware version: $version\n&quot;)</td></tr>
<tr><td class="h">217</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless $supported{$version};</td></tr>
<tr><td class="h">218</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $supported{$version};</td></tr>
<tr><td class="h">219</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">220</td><td colspan="5"></td></tr><tr><td class="h">221</td><td></td><td></td><td></td><td></td><td class="s"># does the SLACKBUILDS.TXT file exist in the sbo tree?</td></tr>
<tr><td class="h">222</td><td></td><td></td><td></td><td></td><td class="s">sub chk_slackbuilds_txt {</td></tr>
<tr><td class="h">223</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (-f &quot;$config{SBO_HOME}/SLACKBUILDS.TXT&quot;) { migrate_repo(); }</td></tr>
<tr><td class="h">224</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return -f $slackbuilds_txt ? 1 : undef;</td></tr>
<tr><td class="h">225</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">226</td><td colspan="5"></td></tr><tr><td class="h">227</td><td></td><td></td><td></td><td></td><td class="s"># Checks if the first argument equals any of the subsequent ones</td></tr>
<tr><td class="h">228</td><td></td><td></td><td></td><td></td><td class="s">sub in {</td></tr>
<tr><td class="h">229</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($first, @rest) = @_;</td></tr>
<tr><td class="h">230</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $arg (@rest) {</td></tr>
<tr><td class="h">231</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 1 if ref $arg eq &#39;Regexp&#39; and $first =~ $arg;</td></tr>
<tr><td class="h">232</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 1 if $first eq $arg;</td></tr>
<tr><td class="h">233</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">234</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 0;</td></tr>
<tr><td class="h">235</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">236</td><td colspan="5"></td></tr><tr><td class="h">237</td><td></td><td></td><td></td><td></td><td class="s">sub idx {</td></tr>
<tr><td class="h">238</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for my $idx (1 .. $#_) {</td></tr>
<tr><td class="h">239</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$_[0] eq $_[$idx] and return $idx - 1;</td></tr>
<tr><td class="h">240</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">241</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return undef;</td></tr>
<tr><td class="h">242</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">243</td><td colspan="5"></td></tr><tr><td class="h">244</td><td></td><td></td><td></td><td></td><td class="s">sub indent {</td></tr>
<tr><td class="h">245</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($indent, $text) = @_;</td></tr>
<tr><td class="h">246</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $text unless $indent;</td></tr>
<tr><td class="h">247</td><td colspan="5"></td></tr><tr><td class="h">248</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @lines = split /\n/, $text;</td></tr>
<tr><td class="h">249</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $line (@lines) {</td></tr>
<tr><td class="h">250</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next unless length($line);</td></tr>
<tr><td class="h">251</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line = (&quot; &quot; x $indent) . $line;</td></tr>
<tr><td class="h">252</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">253</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return join &quot;\n&quot;, @lines;</td></tr>
<tr><td class="h">254</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">255</td><td colspan="5"></td></tr><tr><td class="h">256</td><td></td><td></td><td></td><td></td><td class="s"># Move everything in /usr/sbo except distfiles and repo dirs into repo dir</td></tr>
<tr><td class="h">257</td><td></td><td></td><td></td><td></td><td class="s">sub migrate_repo {</td></tr>
<tr><td class="h">258</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;make_path($repo_path) unless -d $repo_path;</td></tr>
<tr><td class="h">259</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opendir(my $dh, $config{SBO_HOME});</td></tr>
<tr><td class="h">260</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $entry (readdir($dh)) {</td></tr>
<tr><td class="h">261</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next if in($entry =&gt; qw/ . .. repo distfiles /);</td></tr>
<tr><td class="h">262</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;move(&quot;$config{SBO_HOME}/$entry&quot;, &quot;$repo_path/$entry&quot;);</td></tr>
<tr><td class="h">263</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">264</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close $dh;</td></tr>
<tr><td class="h">265</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">266</td><td colspan="5"></td></tr><tr><td class="h">267</td><td></td><td></td><td></td><td></td><td class="s"># check for the validity of new $config{SBO_HOME}</td></tr>
<tr><td class="h">268</td><td></td><td></td><td></td><td></td><td class="s">sub check_repo {</td></tr>
<tr><td class="h">269</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (-d $repo_path) {</td></tr>
<tr><td class="h">270</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opendir(my $repo_handle, $repo_path);</td></tr>
<tr><td class="h">271</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FIRST: while (my $dir = readdir $repo_handle) {</td></tr>
<tr><td class="h">272</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next FIRST if in($dir =&gt; qw/ . .. /);</td></tr>
<tr><td class="h">273</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;usage_error(&quot;$repo_path exists and is not empty. Exiting.\n&quot;);</td></tr>
<tr><td class="h">274</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">275</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">276</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;make_path($repo_path) or usage_error(&quot;Unable to create $repo_path.\n&quot;);</td></tr>
<tr><td class="h">277</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">278</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 1;</td></tr>
<tr><td class="h">279</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">280</td><td colspan="5"></td></tr><tr><td class="h">281</td><td></td><td></td><td></td><td></td><td class="s">sub pull_sbo_tree {</td></tr>
<tr><td class="h">282</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $url = $config{REPO};</td></tr>
<tr><td class="h">283</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($url eq &#39;FALSE&#39;) {</td></tr>
<tr><td class="h">284</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $slk_version = get_slack_version();</td></tr>
<tr><td class="h">285</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url = &quot;rsync://slackbuilds.org/slackbuilds/$slk_version/&quot;;</td></tr>
<tr><td class="h">286</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">287</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unlink($slackbuilds_txt);</td></tr>
<tr><td class="h">288</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">289</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $res = 0;</td></tr>
<tr><td class="h">290</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($url =~ m!^rsync://!) {</td></tr>
<tr><td class="h">291</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$res = rsync_sbo_tree($url);</td></tr>
<tr><td class="h">292</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">293</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$res = git_sbo_tree($url);</td></tr>
<tr><td class="h">294</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">295</td><td colspan="5"></td></tr><tr><td class="h">296</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $wanted = sub {</td></tr>
<tr><td class="h">297</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$File::Find::name ? chown 0, 0, $File::Find::name</td></tr>
<tr><td class="h">298</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: chown 0, 0, $File::Find::dir;</td></tr>
<tr><td class="h">299</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">300</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;find($wanted, $repo_path);</td></tr>
<tr><td class="h">301</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($res and not chk_slackbuilds_txt()) {</td></tr>
<tr><td class="h">302</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;generate_slackbuilds_txt();</td></tr>
<tr><td class="h">303</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">304</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">305</td><td colspan="5"></td></tr><tr><td class="h">306</td><td></td><td></td><td></td><td></td><td class="s"># rsync the sbo tree from slackbuilds.org to $repo_path</td></tr>
<tr><td class="h">307</td><td></td><td></td><td></td><td></td><td class="s">sub rsync_sbo_tree {</td></tr>
<tr><td class="h">308</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_ == 1 or script_error(&#39;rsync_sbo_tree requires an argument.&#39;);</td></tr>
<tr><td class="h">309</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $url = shift;</td></tr>
<tr><td class="h">310</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url .= &#39;/&#39; unless $url =~ m!/$!; # make sure $url ends with /</td></tr>
<tr><td class="h">311</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @info;</td></tr>
<tr><td class="h">312</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# only slackware versions above 14.1 have an rsync that supports --info=progress2</td></tr>
<tr><td class="h">313</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (versioncmp(get_slack_version(), &#39;14.1&#39;) == 1) { @info = (&#39;--info=progress2&#39;); }</td></tr>
<tr><td class="h">314</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @args = (&#39;rsync&#39;, @info, &#39;-a&#39;, &#39;--exclude=*.tar.gz&#39;, &#39;--exclude=*.tar.gz.asc&#39;, &#39;--delete&#39;, $url);</td></tr>
<tr><td class="h">315</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return system(@args, $repo_path) == 0;</td></tr>
<tr><td class="h">316</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">317</td><td colspan="5"></td></tr><tr><td class="h">318</td><td></td><td></td><td></td><td></td><td class="s">sub git_sbo_tree {</td></tr>
<tr><td class="h">319</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_ == 1 or script_error(&#39;git_sbo_tree requires an argument.&#39;);</td></tr>
<tr><td class="h">320</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $url = shift;</td></tr>
<tr><td class="h">321</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (-d &quot;$repo_path/.git&quot; and check_git_remote($repo_path, $url)) {</td></tr>
<tr><td class="h">322</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $cwd = getcwd();</td></tr>
<tr><td class="h">323</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chdir $repo_path;</td></tr>
<tr><td class="h">324</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;system(qw! git fetch !) == 0 or chdir $cwd and return 0;</td></tr>
<tr><td class="h">325</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;system(qw! git reset --hard origin !) == 0 or chdir $cwd and return 0;</td></tr>
<tr><td class="h">326</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unlink &quot;$repo_path/SLACKBUILDS.TXT&quot;;</td></tr>
<tr><td class="h">327</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chdir $cwd and return 1;</td></tr>
<tr><td class="h">328</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">329</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $cwd = getcwd();</td></tr>
<tr><td class="h">330</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chdir $config{SBO_HOME};</td></tr>
<tr><td class="h">331</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remove_tree($repo_path) if -d $repo_path;</td></tr>
<tr><td class="h">332</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;system(qw/ git clone /, $url, $repo_path) == 0 or chdir $cwd and return 0;</td></tr>
<tr><td class="h">333</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chdir $cwd and return 1;</td></tr>
<tr><td class="h">334</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">335</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 0;</td></tr>
<tr><td class="h">336</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">337</td><td colspan="5"></td></tr><tr><td class="h">338</td><td></td><td></td><td></td><td></td><td class="s">sub check_git_remote {</td></tr>
<tr><td class="h">339</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_ == 2 or script_error(&#39;check_git_remote requires two arguments.&#39;);</td></tr>
<tr><td class="h">340</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($path, $url) = @_;</td></tr>
<tr><td class="h">341</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($fh, $exit) = open_read(&quot;$path/.git/config&quot;);</td></tr>
<tr><td class="h">342</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 0 if $exit;</td></tr>
<tr><td class="h">343</td><td colspan="5"></td></tr><tr><td class="h">344</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while (my $line = readline($fh)) {</td></tr>
<tr><td class="h">345</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chomp $line;</td></tr>
<tr><td class="h">346</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($line eq &#39;[remote &quot;origin&quot;]&#39;) {</td></tr>
<tr><td class="h">347</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REMOTE: while (my $remote = readline($fh)) {</td></tr>
<tr><td class="h">348</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;last REMOTE if $remote =~ /^\[/;</td></tr>
<tr><td class="h">349</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 1 if $remote =~ /^\s*url\s*=\s*\Q$url\E$/;</td></tr>
<tr><td class="h">350</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 0 if $remote =~ /^\s*url\s*=/;</td></tr>
<tr><td class="h">351</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">352</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">353</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">354</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 0;</td></tr>
<tr><td class="h">355</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">356</td><td colspan="5"></td></tr><tr><td class="h">357</td><td></td><td></td><td></td><td></td><td class="s">sub generate_slackbuilds_txt {</td></tr>
<tr><td class="h">358</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($fh, $exit) = open_fh($slackbuilds_txt, &#39;&gt;&#39;);</td></tr>
<tr><td class="h">359</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 0 if $exit;</td></tr>
<tr><td class="h">360</td><td colspan="5"></td></tr><tr><td class="h">361</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opendir(my $dh, $repo_path) or return 0;</td></tr>
<tr><td class="h">362</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @categories =</td></tr>
<tr><td class="h">363</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;grep { -d &quot;$repo_path/$_&quot; }</td></tr>
<tr><td class="h">364</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;grep { $_ !~ /^\./ }</td></tr>
<tr><td class="h">365</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;readdir($dh);</td></tr>
<tr><td class="h">366</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close $dh;</td></tr>
<tr><td class="h">367</td><td colspan="5"></td></tr><tr><td class="h">368</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for my $cat (@categories) {</td></tr>
<tr><td class="h">369</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opendir(my $cat_dh, &quot;$repo_path/$cat&quot;) or return 0;</td></tr>
<tr><td class="h">370</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while (my $package = readdir($cat_dh)) {</td></tr>
<tr><td class="h">371</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next if in($package =&gt; qw/ . .. /);</td></tr>
<tr><td class="h">372</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next unless -f &quot;$repo_path/$cat/$package/$package.info&quot;;</td></tr>
<tr><td class="h">373</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print { $fh } &quot;SLACKBUILD NAME: $package\n&quot;;</td></tr>
<tr><td class="h">374</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print { $fh } &quot;SLACKBUILD LOCATION: ./$cat/$package\n&quot;;</td></tr>
<tr><td class="h">375</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">376</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close $cat_dh;</td></tr>
<tr><td class="h">377</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">378</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close $fh;</td></tr>
<tr><td class="h">379</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 1;</td></tr>
<tr><td class="h">380</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">381</td><td colspan="5"></td></tr><tr><td class="h">382</td><td></td><td></td><td></td><td></td><td class="s"># wrappers for differing checks and output</td></tr>
<tr><td class="h">383</td><td></td><td></td><td></td><td></td><td class="s">sub fetch_tree {</td></tr>
<tr><td class="h">384</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;check_repo();</td></tr>
<tr><td class="h">385</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;say &#39;Pulling SlackBuilds tree...&#39;;</td></tr>
<tr><td class="h">386</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pull_sbo_tree(), return 1;</td></tr>
<tr><td class="h">387</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">388</td><td colspan="5"></td></tr><tr><td class="h">389</td><td></td><td></td><td></td><td></td><td class="s">sub update_tree {</td></tr>
<tr><td class="h">390</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fetch_tree(), return() unless chk_slackbuilds_txt();</td></tr>
<tr><td class="h">391</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;say &#39;Updating SlackBuilds tree...&#39;;</td></tr>
<tr><td class="h">392</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pull_sbo_tree(), return 1;</td></tr>
<tr><td class="h">393</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">394</td><td colspan="5"></td></tr><tr><td class="h">395</td><td></td><td></td><td></td><td></td><td class="s"># if the SLACKBUILDS.TXT is not in $repo_path, we assume the tree has</td></tr>
<tr><td class="h">396</td><td></td><td></td><td></td><td></td><td class="s"># not been populated there; prompt the user to automagickally pull the tree.</td></tr>
<tr><td class="h">397</td><td></td><td></td><td></td><td></td><td class="s">sub slackbuilds_or_fetch {</td></tr>
<tr><td class="h">398</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless (chk_slackbuilds_txt()) {</td></tr>
<tr><td class="h">399</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;say &#39;It looks like you haven\&#39;t run &quot;sbosnap fetch&quot; yet.&#39;;</td></tr>
<tr><td class="h">400</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print &#39;Would you like me to do this now? [y] &#39;;</td></tr>
<tr><td class="h">401</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (&lt;STDIN&gt; =~ /^[Yy\n]/) {</td></tr>
<tr><td class="h">402</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fetch_tree();</td></tr>
<tr><td class="h">403</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">404</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;say &#39;Please run &quot;sbosnap fetch&quot;&#39;;</td></tr>
<tr><td class="h">405</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit 0;</td></tr>
<tr><td class="h">406</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">407</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">408</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 1;</td></tr>
<tr><td class="h">409</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">410</td><td colspan="5"></td></tr><tr><td class="h">411</td><td></td><td></td><td></td><td></td><td class="s"># pull an array of hashes, each hash containing the name and version of a </td></tr>
<tr><td class="h">412</td><td></td><td></td><td></td><td></td><td class="s"># package currently installed. Gets filtered using STD, SBO or ALL.</td></tr>
<tr><td class="h">413</td><td></td><td></td><td></td><td></td><td class="s">sub get_installed_packages {</td></tr>
<tr><td class="h">414</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_ == 1 or script_error(&#39;get_installed_packages requires an argument.&#39;);</td></tr>
<tr><td class="h">415</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $filter = shift;</td></tr>
<tr><td class="h">416</td><td colspan="5"></td></tr><tr><td class="h">417</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Valid types: STD, SBO</td></tr>
<tr><td class="h">418</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my (@pkgs, %types);</td></tr>
<tr><td class="h">419</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $pkg (glob(&quot;$pkg_db/*&quot;)) {</td></tr>
<tr><td class="h">420</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($name, $version, $build) = $pkg =~ m#/([^/]+)-([^-]+)-[^-]+-([^-]+)$#</td></tr>
<tr><td class="h">421</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or next;</td></tr>
<tr><td class="h">422</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @pkgs, { name =&gt; $name, version =&gt; $version, build =&gt; $build };</td></tr>
<tr><td class="h">423</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$types{$name} = &#39;STD&#39;;</td></tr>
<tr><td class="h">424</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">425</td><td colspan="5"></td></tr><tr><td class="h">426</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# If we want all packages, let&#39;s just return them all</td></tr>
<tr><td class="h">427</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return [ map { +{ name =&gt; $_-&gt;{name}, version =&gt; $_-&gt;{version} } } @pkgs ] if $filter eq &#39;ALL&#39;;</td></tr>
<tr><td class="h">428</td><td colspan="5"></td></tr><tr><td class="h">429</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Otherwise, mark the SBO ones and filter</td></tr>
<tr><td class="h">430</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @sbos = map { $_-&gt;{name} } grep { $_-&gt;{build} =~ m/_SBo(|compat32)$/ } @pkgs;</td></tr>
<tr><td class="h">431</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (@sbos) {</td></tr>
<tr><td class="h">432</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my %locations = get_sbo_locations(map { s/-compat32//gr } @sbos);</td></tr>
<tr><td class="h">433</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $sbo (@sbos) { $types{$sbo} = &#39;SBO&#39; if $locations{ $sbo =~ s/-compat32//gr }; }</td></tr>
<tr><td class="h">434</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">435</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return [ map { +{ name =&gt; $_-&gt;{name}, version =&gt; $_-&gt;{version} } } grep { $types{$_-&gt;{name}} eq $filter } @pkgs ];</td></tr>
<tr><td class="h">436</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">437</td><td colspan="5"></td></tr><tr><td class="h">438</td><td></td><td></td><td></td><td></td><td class="s"># for a ref to an array of hashes of installed packages, return an array ref</td></tr>
<tr><td class="h">439</td><td></td><td></td><td></td><td></td><td class="s"># consisting of just their names</td></tr>
<tr><td class="h">440</td><td></td><td></td><td></td><td></td><td class="s">sub get_inst_names {</td></tr>
<tr><td class="h">441</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_ == 1 or script_error(&#39;get_inst_names requires an argument.&#39;);</td></tr>
<tr><td class="h">442</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $inst = shift;</td></tr>
<tr><td class="h">443</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @installed;</td></tr>
<tr><td class="h">444</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @installed, $$_{name} for @$inst;</td></tr>
<tr><td class="h">445</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return \@installed;</td></tr>
<tr><td class="h">446</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">447</td><td colspan="5"></td></tr><tr><td class="h">448</td><td></td><td></td><td></td><td></td><td class="s"># search the SLACKBUILDS.TXT for a given sbo&#39;s directory</td></tr>
<tr><td class="h">449</td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">450</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# a state variable for get_sbo_location and get_sbo_locations</td></tr>
<tr><td class="h">451</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $store = {};</td></tr>
<tr><td class="h">452</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my %local;</td></tr>
<tr><td class="h">453</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my %orig;</td></tr>
<tr><td class="h">454</td><td colspan="5"></td></tr><tr><td class="h">455</td><td></td><td></td><td></td><td></td><td class="s">sub get_sbo_location {</td></tr>
<tr><td class="h">456</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_ &gt;= 1 or script_error(&#39;get_sbo_location requires an argument.&#39;);</td></tr>
<tr><td class="h">457</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @sbos = ref $_[0] eq &#39;ARRAY&#39; ? @{ $_[0] } : @_;</td></tr>
<tr><td class="h">458</td><td colspan="5"></td></tr><tr><td class="h">459</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# if we already have the location, return it now.</td></tr>
<tr><td class="h">460</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $$store{$sbos[0]} if exists $$store{$sbos[0]};</td></tr>
<tr><td class="h">461</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my %locations = get_sbo_locations(@sbos);</td></tr>
<tr><td class="h">462</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $locations{$sbos[0]};</td></tr>
<tr><td class="h">463</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">464</td><td colspan="5"></td></tr><tr><td class="h">465</td><td></td><td></td><td></td><td></td><td class="s">sub get_sbo_locations {</td></tr>
<tr><td class="h">466</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_ &gt;= 1 or script_error(&#39;get_sbo_locations requires an argument.&#39;);</td></tr>
<tr><td class="h">467</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @sbos = @_;</td></tr>
<tr><td class="h">468</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@sbos = @{ $sbos[0] } if ref $sbos[0] eq &#39;ARRAY&#39;;</td></tr>
<tr><td class="h">469</td><td colspan="5"></td></tr><tr><td class="h">470</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my %locations;</td></tr>
<tr><td class="h">471</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($fh, $exit) = open_read($slackbuilds_txt);</td></tr>
<tr><td class="h">472</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($exit) {</td></tr>
<tr><td class="h">473</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;warn $fh;</td></tr>
<tr><td class="h">474</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit $exit;</td></tr>
<tr><td class="h">475</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">476</td><td colspan="5"></td></tr><tr><td class="h">477</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# if an sbo is already in the $store, set the %location for it and filter it out</td></tr>
<tr><td class="h">478</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@sbos = grep { exists $$store{$_} ? ($locations{$_} = $$store{$_}, 0) : 1 } @sbos;</td></tr>
<tr><td class="h">479</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return %locations unless @sbos;</td></tr>
<tr><td class="h">480</td><td colspan="5"></td></tr><tr><td class="h">481</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while (my $line = &lt;$fh&gt;) {</td></tr>
<tr><td class="h">482</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($loc, $sbo) = $line =~ m!LOCATION:\s+\.(/[^/]+/([^/\n]+))$!</td></tr>
<tr><td class="h">483</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or next;</td></tr>
<tr><td class="h">484</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $found = idx($sbo, @sbos);</td></tr>
<tr><td class="h">485</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next unless defined $found;</td></tr>
<tr><td class="h">486</td><td colspan="5"></td></tr><tr><td class="h">487</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$$store{$sbo} = $repo_path . $loc;</td></tr>
<tr><td class="h">488</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$locations{$sbo} = $$store{$sbo};</td></tr>
<tr><td class="h">489</td><td colspan="5"></td></tr><tr><td class="h">490</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;splice @sbos, $found, 1;</td></tr>
<tr><td class="h">491</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;last unless @sbos;</td></tr>
<tr><td class="h">492</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">493</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close $fh;</td></tr>
<tr><td class="h">494</td><td colspan="5"></td></tr><tr><td class="h">495</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# after we&#39;ve checked the regular sbo locations, we&#39;ll see if it needs to</td></tr>
<tr><td class="h">496</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# be overridden by a local change</td></tr>
<tr><td class="h">497</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $local = $config{LOCAL_OVERRIDES};</td></tr>
<tr><td class="h">498</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless ( $local eq &#39;FALSE&#39; ) {</td></tr>
<tr><td class="h">499</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for my $sbo (@sbos, keys %locations) {</td></tr>
<tr><td class="h">500</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $loc = &quot;$local/$sbo&quot;;</td></tr>
<tr><td class="h">501</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next unless -d $loc;</td></tr>
<tr><td class="h">502</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$$store{$sbo} = $loc;</td></tr>
<tr><td class="h">503</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$orig{$sbo} //= $locations{$sbo};</td></tr>
<tr><td class="h">504</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$locations{$sbo} = $loc;</td></tr>
<tr><td class="h">505</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$local{$sbo} = $local;</td></tr>
<tr><td class="h">506</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">507</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">508</td><td colspan="5"></td></tr><tr><td class="h">509</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return %locations;</td></tr>
<tr><td class="h">510</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">511</td><td colspan="5"></td></tr><tr><td class="h">512</td><td></td><td></td><td></td><td></td><td class="s">sub is_local {</td></tr>
<tr><td class="h">513</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_ == 1 or script_error(&#39;is_local requires an argument.&#39;);</td></tr>
<tr><td class="h">514</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $sbo = shift;</td></tr>
<tr><td class="h">515</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Make sure we have checked for the slackbuild in question:</td></tr>
<tr><td class="h">516</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get_sbo_location($sbo);</td></tr>
<tr><td class="h">517</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return !!$local{$sbo};</td></tr>
<tr><td class="h">518</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">519</td><td colspan="5"></td></tr><tr><td class="h">520</td><td></td><td></td><td></td><td></td><td class="s">sub get_orig_location {</td></tr>
<tr><td class="h">521</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_ == 1 or script_error(&#39;get_orig_location requires an argument.&#39;);</td></tr>
<tr><td class="h">522</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $sbo = shift;</td></tr>
<tr><td class="h">523</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Make sure we have checked for the slackbuild in question:</td></tr>
<tr><td class="h">524</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get_sbo_location($sbo);</td></tr>
<tr><td class="h">525</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $orig{$sbo};</td></tr>
<tr><td class="h">526</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">527</td><td colspan="5"></td></tr><tr><td class="h">528</td><td></td><td></td><td></td><td></td><td class="s">sub get_orig_version {</td></tr>
<tr><td class="h">529</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_ == 1 or script_error(&#39;get_orig_version requires an argument.&#39;);</td></tr>
<tr><td class="h">530</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $sbo = shift;</td></tr>
<tr><td class="h">531</td><td colspan="5"></td></tr><tr><td class="h">532</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $location = get_orig_location($sbo);</td></tr>
<tr><td class="h">533</td><td colspan="5"></td></tr><tr><td class="h">534</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $location if not defined $location;</td></tr>
<tr><td class="h">535</td><td colspan="5"></td></tr><tr><td class="h">536</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return get_sbo_version($location);</td></tr>
<tr><td class="h">537</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">538</td><td colspan="5"></td></tr><tr><td class="h">539</td><td></td><td></td><td></td><td></td><td class="s">sub get_local_outdated_versions {</td></tr>
<tr><td class="h">540</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @outdated;</td></tr>
<tr><td class="h">541</td><td colspan="5"></td></tr><tr><td class="h">542</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $local = $config{LOCAL_OVERRIDES};</td></tr>
<tr><td class="h">543</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless ( $local eq &#39;FALSE&#39; ) {</td></tr>
<tr><td class="h">544</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $pkglist = get_installed_packages(&#39;SBO&#39;);</td></tr>
<tr><td class="h">545</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @local = grep { is_local($_-&gt;{name}) } @$pkglist;</td></tr>
<tr><td class="h">546</td><td colspan="5"></td></tr><tr><td class="h">547</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $sbo (@local) {</td></tr>
<tr><td class="h">548</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $orig = get_orig_version($sbo-&gt;{name});</td></tr>
<tr><td class="h">549</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next if not defined $orig;</td></tr>
<tr><td class="h">550</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next if not versioncmp($orig, $sbo-&gt;{version});</td></tr>
<tr><td class="h">551</td><td colspan="5"></td></tr><tr><td class="h">552</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @outdated, { %$sbo, orig =&gt; $orig };</td></tr>
<tr><td class="h">553</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">554</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">555</td><td colspan="5"></td></tr><tr><td class="h">556</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return @outdated;</td></tr>
<tr><td class="h">557</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">558</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">559</td><td colspan="5"></td></tr><tr><td class="h">560</td><td></td><td></td><td></td><td></td><td class="s"># pull the sbo name from a $location: $repo_path/system/wine, etc.</td></tr>
<tr><td class="h">561</td><td></td><td></td><td></td><td></td><td class="s">sub get_sbo_from_loc {</td></tr>
<tr><td class="h">562</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_ == 1 or script_error(&#39;get_sbo_from_loc requires an argument.&#39;);</td></tr>
<tr><td class="h">563</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return (shift =~ qr#/([^/]+)$#)[0];</td></tr>
<tr><td class="h">564</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">565</td><td colspan="5"></td></tr><tr><td class="h">566</td><td></td><td></td><td></td><td></td><td class="s"># pull piece(s) of data, GET, from the $sbo.info file under LOCATION.</td></tr>
<tr><td class="h">567</td><td></td><td></td><td></td><td></td><td class="s">sub get_from_info {</td></tr>
<tr><td class="h">568</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my %args = (</td></tr>
<tr><td class="h">569</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOCATION&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; &#39;&#39;,</td></tr>
<tr><td class="h">570</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GET&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; &#39;&#39;,</td></tr>
<tr><td class="h">571</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_</td></tr>
<tr><td class="h">572</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">573</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless ($args{LOCATION} &amp;&amp; $args{GET}) {</td></tr>
<tr><td class="h">574</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;script_error(&#39;get_from_info requires LOCATION and GET.&#39;);</td></tr>
<tr><td class="h">575</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">576</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;state $store = {LOCATION =&gt; [&#39;&#39;]};</td></tr>
<tr><td class="h">577</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $sbo = get_sbo_from_loc($args{LOCATION});</td></tr>
<tr><td class="h">578</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $store-&gt;{$args{GET}} if $store-&gt;{LOCATION}[0] eq $args{LOCATION};</td></tr>
<tr><td class="h">579</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# if we&#39;re here, we haven&#39;t read in the .info file yet.</td></tr>
<tr><td class="h">580</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($fh, $exit) = open_read(&quot;$args{LOCATION}/$sbo.info&quot;);</td></tr>
<tr><td class="h">581</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return() if $exit;</td></tr>
<tr><td class="h">582</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# suck it all in, clean it all up, stuff it all in $store.</td></tr>
<tr><td class="h">583</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $contents = do {local $/; &lt;$fh&gt;};</td></tr>
<tr><td class="h">584</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$contents =~ s/(&quot;|\\\n)//g;</td></tr>
<tr><td class="h">585</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $last_key = &#39;&#39;;</td></tr>
<tr><td class="h">586</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$store = {};</td></tr>
<tr><td class="h">587</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$store-&gt;{LOCATION} = [$args{LOCATION}];</td></tr>
<tr><td class="h">588</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $line (split /\n/, $contents) {</td></tr>
<tr><td class="h">589</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($key, $val) = $last_key;</td></tr>
<tr><td class="h">590</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($line =~ /^([^=\s]+)=(.*)$/)&nbsp;&nbsp;{ $key = $1; $val = $2; }</td></tr>
<tr><td class="h">591</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elsif ($line =~ /^\s+([^\s].+)$/) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$val = $1; }</td></tr>
<tr><td class="h">592</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else { script_error(&quot;error when parsing $sbo.info file. Line: $line&quot;) }</td></tr>
<tr><td class="h">593</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @{ $store-&gt;{$key} }, ($val ? split(&#39; &#39;, $val) : $val);</td></tr>
<tr><td class="h">594</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$last_key = $key;</td></tr>
<tr><td class="h">595</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">596</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# allow local overrides to get away with not having quite all the fields</td></tr>
<tr><td class="h">597</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (is_local($sbo)) {</td></tr>
<tr><td class="h">598</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for my $key (qw/DOWNLOAD_x86_64 MD5SUM_x86_64 REQUIRES/) {</td></tr>
<tr><td class="h">599</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$store-&gt;{$key} //= [&#39;&#39;]; # if they don&#39;t exist, treat them as empty</td></tr>
<tr><td class="h">600</td><td><div class="c3">1530</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">601</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">602</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $store-&gt;{$args{GET}};</td></tr>
<tr><td class="h">603</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">604</td><td colspan="5"></td></tr><tr><td class="h">605</td><td></td><td></td><td></td><td></td><td class="s"># find the version in the tree for a given sbo (provided a location)</td></tr>
<tr><td class="h">606</td><td></td><td></td><td></td><td></td><td class="s">sub get_sbo_version {</td></tr>
<tr><td class="h">607</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_ == 1 or script_error(&#39;get_sbo_version requires an argument.&#39;);</td></tr>
<tr><td class="h">608</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $version = get_from_info(LOCATION =&gt; shift, GET =&gt; &#39;VERSION&#39;);</td></tr>
<tr><td class="h">609</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $$version[0] ? $$version[0] : undef;</td></tr>
<tr><td class="h">610</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">611</td><td colspan="5"></td></tr><tr><td class="h">612</td><td></td><td></td><td></td><td></td><td class="s"># for each installed sbo, find out whether or not the version in the tree is</td></tr>
<tr><td class="h">613</td><td></td><td></td><td></td><td></td><td class="s"># newer, and compile an array of hashes containing those which are</td></tr>
<tr><td class="h">614</td><td></td><td></td><td></td><td></td><td class="s">sub get_available_updates {</td></tr>
<tr><td class="h">615</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @updates;</td></tr>
<tr><td class="h">616</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $pkg_list = get_installed_packages(&#39;SBO&#39;);</td></tr>
<tr><td class="h">617</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FIRST: for my $key (keys @$pkg_list) {</td></tr>
<tr><td class="h">618</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $location = get_sbo_location($$pkg_list[$key]{name});</td></tr>
<tr><td class="h">619</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# if we can&#39;t find a location, assume invalid and skip</td></tr>
<tr><td class="h">620</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next FIRST unless $location;</td></tr>
<tr><td class="h">621</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $version = get_sbo_version($location);</td></tr>
<tr><td class="h">622</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (versioncmp($version, $$pkg_list[$key]{version}) != 0) {</td></tr>
<tr><td class="h">623</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @updates, {</td></tr>
<tr><td class="h">624</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; $$pkg_list[$key]{name},</td></tr>
<tr><td class="h">625</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;installed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; $$pkg_list[$key]{version},</td></tr>
<tr><td class="h">626</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;update&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; $version</td></tr>
<tr><td class="h">627</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">628</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">629</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">630</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return \@updates;</td></tr>
<tr><td class="h">631</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">632</td><td colspan="5"></td></tr><tr><td class="h">633</td><td></td><td></td><td></td><td></td><td class="s"># get downloads and md5sums from an sbo&#39;s .info file, first </td></tr>
<tr><td class="h">634</td><td></td><td></td><td></td><td></td><td class="s"># checking for x86_64-specific info if we are told to</td></tr>
<tr><td class="h">635</td><td></td><td></td><td></td><td></td><td class="s">sub get_download_info {</td></tr>
<tr><td class="h">636</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my %args = (</td></tr>
<tr><td class="h">637</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOCATION&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 0,</td></tr>
<tr><td class="h">638</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;X64&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 1,</td></tr>
<tr><td class="h">639</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_</td></tr>
<tr><td class="h">640</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">641</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$args{LOCATION} or script_error(&#39;get_download_info requires LOCATION.&#39;);</td></tr>
<tr><td class="h">642</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($get, $downs, $exit, $md5s, %return);</td></tr>
<tr><td class="h">643</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$get = ($args{X64} ? &#39;DOWNLOAD_x86_64&#39; : &#39;DOWNLOAD&#39;);</td></tr>
<tr><td class="h">644</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$downs = get_from_info(LOCATION =&gt; $args{LOCATION}, GET =&gt; $get);</td></tr>
<tr><td class="h">645</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# did we get nothing back, or UNSUPPORTED/UNTESTED?</td></tr>
<tr><td class="h">646</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($args{X64}) {</td></tr>
<tr><td class="h">647</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (! $$downs[0] || $$downs[0] =~ qr/^UN(SUPPOR|TES)TED$/) {</td></tr>
<tr><td class="h">648</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$args{X64} = 0;</td></tr>
<tr><td class="h">649</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$downs = get_from_info(LOCATION =&gt; $args{LOCATION},</td></tr>
<tr><td class="h">650</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GET =&gt; &#39;DOWNLOAD&#39;);</td></tr>
<tr><td class="h">651</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">652</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">653</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# if we still don&#39;t have any links, something is really wrong.</td></tr>
<tr><td class="h">654</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return() unless $$downs[0];</td></tr>
<tr><td class="h">655</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# grab the md5s and build a hash</td></tr>
<tr><td class="h">656</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$get = $args{X64} ? &#39;MD5SUM_x86_64&#39; : &#39;MD5SUM&#39;;</td></tr>
<tr><td class="h">657</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$md5s = get_from_info(LOCATION =&gt; $args{LOCATION}, GET =&gt; $get);</td></tr>
<tr><td class="h">658</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return() unless $$md5s[0];</td></tr>
<tr><td class="h">659</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$return{$$downs[$_]} = $$md5s[$_] for (keys @$downs);</td></tr>
<tr><td class="h">660</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return \%return;</td></tr>
<tr><td class="h">661</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">662</td><td colspan="5"></td></tr><tr><td class="h">663</td><td></td><td></td><td></td><td></td><td class="s">sub get_arch {</td></tr>
<tr><td class="h">664</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chomp(my $arch = `uname -m`);</td></tr>
<tr><td class="h">665</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $arch;</td></tr>
<tr><td class="h">666</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">667</td><td colspan="5"></td></tr><tr><td class="h">668</td><td></td><td></td><td></td><td></td><td class="s"># TODO: should probably combine this with get_download_info</td></tr>
<tr><td class="h">669</td><td></td><td></td><td></td><td></td><td class="s">sub get_sbo_downloads {</td></tr>
<tr><td class="h">670</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my %args = (</td></tr>
<tr><td class="h">671</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOCATION&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; &#39;&#39;,</td></tr>
<tr><td class="h">672</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 0,</td></tr>
<tr><td class="h">673</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_</td></tr>
<tr><td class="h">674</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">675</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$args{LOCATION} or script_error(&#39;get_sbo_downloads requires LOCATION.&#39;);</td></tr>
<tr><td class="h">676</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $location = $args{LOCATION};</td></tr>
<tr><td class="h">677</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-d $location or script_error(&#39;get_sbo_downloads given a non-directory.&#39;);</td></tr>
<tr><td class="h">678</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $arch = get_arch();</td></tr>
<tr><td class="h">679</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $dl_info;</td></tr>
<tr><td class="h">680</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($arch eq &#39;x86_64&#39;) {</td></tr>
<tr><td class="h">681</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$dl_info = get_download_info(LOCATION =&gt; $location) unless $args{32};</td></tr>
<tr><td class="h">682</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">683</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless (keys %$dl_info &gt; 0) {</td></tr>
<tr><td class="h">684</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$dl_info = get_download_info(LOCATION =&gt; $location, X64 =&gt; 0);</td></tr>
<tr><td class="h">685</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">686</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $dl_info;</td></tr>
<tr><td class="h">687</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">688</td><td colspan="5"></td></tr><tr><td class="h">689</td><td></td><td></td><td></td><td></td><td class="s"># given a link, grab the filename from it and prepend $distfiles</td></tr>
<tr><td class="h">690</td><td></td><td></td><td></td><td></td><td class="s">sub _get_fname {</td></tr>
<tr><td class="h">691</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $fn = shift;</td></tr>
<tr><td class="h">692</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $regex = qr#/([^/]+)$#;</td></tr>
<tr><td class="h">693</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($filename) = $fn =~ $regex;</td></tr>
<tr><td class="h">694</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$filename =~ s/%2B/+/g if $filename;</td></tr>
<tr><td class="h">695</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $filename;</td></tr>
<tr><td class="h">696</td><td colspan="5"></td></tr><tr><td class="h">697</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">698</td><td></td><td></td><td></td><td></td><td class="s">sub get_filename_from_link {</td></tr>
<tr><td class="h">699</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_ == 1 or script_error(&#39;get_filename_from_link requires an argument&#39;);</td></tr>
<tr><td class="h">700</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $filename = _get_fname(shift);</td></tr>
<tr><td class="h">701</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return undef unless defined $filename;</td></tr>
<tr><td class="h">702</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &quot;$distfiles/$filename&quot;;</td></tr>
<tr><td class="h">703</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">704</td><td colspan="5"></td></tr><tr><td class="h">705</td><td></td><td></td><td></td><td></td><td class="s"># for a given file, compute its md5sum</td></tr>
<tr><td class="h">706</td><td></td><td></td><td></td><td></td><td class="s">sub compute_md5sum {</td></tr>
<tr><td class="h">707</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-f $_[0] or script_error(&#39;compute_md5sum requires a file argument.&#39;);</td></tr>
<tr><td class="h">708</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($fh, $exit) = open_read(shift);</td></tr>
<tr><td class="h">709</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $md5 = Digest::MD5-&gt;new;</td></tr>
<tr><td class="h">710</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$md5-&gt;addfile($fh);</td></tr>
<tr><td class="h">711</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $md5sum = $md5-&gt;hexdigest;</td></tr>
<tr><td class="h">712</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close $fh;</td></tr>
<tr><td class="h">713</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $md5sum;</td></tr>
<tr><td class="h">714</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">715</td><td colspan="5"></td></tr><tr><td class="h">716</td><td></td><td></td><td></td><td></td><td class="s"># for a given distfile, see whether or not it exists, and if so, if its md5sum</td></tr>
<tr><td class="h">717</td><td></td><td></td><td></td><td></td><td class="s"># matches the sbo&#39;s .info file</td></tr>
<tr><td class="h">718</td><td></td><td></td><td></td><td></td><td class="s">sub verify_distfile {</td></tr>
<tr><td class="h">719</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_ == 2 or script_error(&#39;verify_distfile requires two arguments.&#39;);</td></tr>
<tr><td class="h">720</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($link, $info_md5) = @_;</td></tr>
<tr><td class="h">721</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $filename = get_filename_from_link($link);</td></tr>
<tr><td class="h">722</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return() unless -f $filename;</td></tr>
<tr><td class="h">723</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $md5sum = compute_md5sum($filename);</td></tr>
<tr><td class="h">724</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $info_md5 eq $md5sum ? 1 : 0;</td></tr>
<tr><td class="h">725</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">726</td><td colspan="5"></td></tr><tr><td class="h">727</td><td></td><td></td><td></td><td></td><td class="s"># for a given distfile, attempt to retrieve it and, if successful, check its</td></tr>
<tr><td class="h">728</td><td></td><td></td><td></td><td></td><td class="s"># md5sum against that in the sbo&#39;s .info file</td></tr>
<tr><td class="h">729</td><td></td><td></td><td></td><td></td><td class="s">sub get_distfile {</td></tr>
<tr><td class="h">730</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_ == 2 or script_error(&#39;get_distfile requires two arguments&#39;);</td></tr>
<tr><td class="h">731</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($link, $info_md5) = @_;</td></tr>
<tr><td class="h">732</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $filename = get_filename_from_link($link);</td></tr>
<tr><td class="h">733</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mkdir $distfiles unless -d $distfiles;</td></tr>
<tr><td class="h">734</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chdir $distfiles;</td></tr>
<tr><td class="h">735</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unlink $filename if -f $filename;</td></tr>
<tr><td class="h">736</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $fail = {};</td></tr>
<tr><td class="h">737</td><td colspan="5"></td></tr><tr><td class="h">738</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;if wget $link &amp;&amp; verify, return</td></tr>
<tr><td class="h">739</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;else wget sbosrcarch &amp;&amp; verify</td></tr>
<tr><td class="h">740</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (system(&#39;wget&#39;, &#39;--no-check-certificate&#39;, $link) != 0) {</td></tr>
<tr><td class="h">741</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$fail-&gt;{msg} = &quot;Unable to wget $link.\n&quot;;</td></tr>
<tr><td class="h">742</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$fail-&gt;{err} = _ERR_DOWNLOAD;</td></tr>
<tr><td class="h">743</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">744</td><td><div class="c3">1530</div><div class="c3">1530</div><div class="c3">1530</div></td><td></td><td></td><td><div class="c3"><a href="SBO-Lib-lib-SBO-Lib-pm--subroutine.html#L744">1530</a></div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 1 if not %$fail and verify_distfile(@_);</td></tr>
<tr><td class="h">745</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (not %$fail) {</td></tr>
<tr><td class="h">746</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$fail-&gt;{msg} = &quot;md5sum failure for $filename.\n&quot;;</td></tr>
<tr><td class="h">747</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$fail-&gt;{err} = _ERR_MD5SUM;</td></tr>
<tr><td class="h">748</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">749</td><td colspan="5"></td></tr><tr><td class="h">750</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# since the download from the original link either didn&#39;t download or</td></tr>
<tr><td class="h">751</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# didn&#39;t verify, try to get it from sbosrcarch instead</td></tr>
<tr><td class="h">752</td><td><div class="c3">1530</div><div class="c3">1530</div><div class="c3">1530</div></td><td></td><td></td><td><div class="c3"><a href="SBO-Lib-lib-SBO-Lib-pm--subroutine.html#L752">1530</a></div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unlink $filename if -f $filename;</td></tr>
<tr><td class="h">753</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $sbosrcarch = sprintf(</td></tr>
<tr><td class="h">754</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;ftp://slackware.uk/sbosrcarch/by-md5/%s/%s/%s/%s&quot;,</td></tr>
<tr><td class="h">755</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;substr($info_md5, 0, 1), substr($info_md5, 1, 1), $info_md5, _get_fname($link));</td></tr>
<tr><td class="h">756</td><td colspan="5"></td></tr><tr><td class="h">757</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 1 if</td></tr>
<tr><td class="h">758</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;system(&#39;wget&#39;, &#39;--no-check-certificate&#39;, $sbosrcarch) == 0 and</td></tr>
<tr><td class="h">759</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify_distfile(@_);</td></tr>
<tr><td class="h">760</td><td colspan="5"></td></tr><tr><td class="h">761</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $fail-&gt;{msg}, $fail-&gt;{err};</td></tr>
<tr><td class="h">762</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">763</td><td colspan="5"></td></tr><tr><td class="h">764</td><td></td><td></td><td></td><td></td><td class="s"># for a given distfile, figure out what the full path to its symlink will be</td></tr>
<tr><td class="h">765</td><td></td><td></td><td></td><td></td><td class="s">sub get_symlink_from_filename {</td></tr>
<tr><td class="h">766</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_ == 2 or script_error(</td></tr>
<tr><td class="h">767</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;get_symlink_from_filename requires two arguments&#39;);</td></tr>
<tr><td class="h">768</td><td><div class="c3">1530</div><div class="c3">1530</div><div class="c3">1530</div></td><td></td><td></td><td><div class="c3"><a href="SBO-Lib-lib-SBO-Lib-pm--subroutine.html#L768">1530</a></div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-f $_[0] or script_error(</td></tr>
<tr><td class="h">769</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;get_symlink_from_filename first argument is not a file&#39;);</td></tr>
<tr><td class="h">770</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($filename, $location) = @_;</td></tr>
<tr><td class="h">771</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &quot;$location/&quot;. ($filename =~ qr#/([^/]+)$#)[0];</td></tr>
<tr><td class="h">772</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">773</td><td colspan="5"></td></tr><tr><td class="h">774</td><td></td><td></td><td></td><td></td><td class="s"># determine whether or not a given sbo is 32-bit only</td></tr>
<tr><td class="h">775</td><td></td><td></td><td></td><td></td><td class="s">sub check_x32 {</td></tr>
<tr><td class="h">776</td><td><div class="c3">1530</div><div class="c3">1530</div><div class="c3">1530</div></td><td></td><td></td><td><div class="c3"><a href="SBO-Lib-lib-SBO-Lib-pm--subroutine.html#L776">1530</a></div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_ == 1 or script_error(&#39;check_x32 requires an argument.&#39;);</td></tr>
<tr><td class="h">777</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $dl = get_from_info(LOCATION =&gt; shift, GET =&gt; &#39;DOWNLOAD_x86_64&#39;);</td></tr>
<tr><td class="h">778</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $$dl[0] =~ /UN(SUPPOR|TES)TED/ ? 1 : undef;</td></tr>
<tr><td class="h">779</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">780</td><td colspan="5"></td></tr><tr><td class="h">781</td><td></td><td></td><td></td><td></td><td class="s"># can&#39;t do 32-bit on x86_64 without this file, so we&#39;ll use it as the test to</td></tr>
<tr><td class="h">782</td><td></td><td></td><td></td><td></td><td class="s"># to determine whether or not an x86_64 system is setup for multilib</td></tr>
<tr><td class="h">783</td><td></td><td></td><td></td><td></td><td class="s">sub check_multilib {</td></tr>
<tr><td class="h">784</td><td><div class="c3">1530</div><div class="c3">1530</div><div class="c3">1530</div></td><td></td><td></td><td><div class="c3"><a href="SBO-Lib-lib-SBO-Lib-pm--subroutine.html#L784">1530</a></div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 1 if -f &#39;/etc/profile.d/32dev.sh&#39;;</td></tr>
<tr><td class="h">785</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return();</td></tr>
<tr><td class="h">786</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">787</td><td colspan="5"></td></tr><tr><td class="h">788</td><td></td><td></td><td></td><td></td><td class="s"># given a list of downloads, return just the filenames</td></tr>
<tr><td class="h">789</td><td></td><td></td><td></td><td></td><td class="s">sub get_dl_fns {</td></tr>
<tr><td class="h">790</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $fns = shift;</td></tr>
<tr><td class="h">791</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $return;</td></tr>
<tr><td class="h">792</td><td><div class="c3">1530</div><div class="c3">1530</div><div class="c3">1530</div></td><td></td><td></td><td><div class="c3"><a href="SBO-Lib-lib-SBO-Lib-pm--subroutine.html#L792">1530</a></div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @$return, ($_ =~ qr|/([^/]+)$|)[0] for @$fns;</td></tr>
<tr><td class="h">793</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $return;</td></tr>
<tr><td class="h">794</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">795</td><td colspan="5"></td></tr><tr><td class="h">796</td><td></td><td></td><td></td><td></td><td class="s"># given a line that looks like it&#39;s decompressing something, try to return a</td></tr>
<tr><td class="h">797</td><td></td><td></td><td></td><td></td><td class="s"># valid filename regex</td></tr>
<tr><td class="h">798</td><td></td><td></td><td></td><td></td><td class="s">sub get_dc_regex {</td></tr>
<tr><td class="h">799</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $line = shift;</td></tr>
<tr><td class="h">800</td><td><div class="c3">1530</div><div class="c3">1530</div><div class="c3">1530</div></td><td></td><td></td><td><div class="c3"><a href="SBO-Lib-lib-SBO-Lib-pm--subroutine.html#L800">1530</a></div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# get rid of initial &#39;tar x&#39;whatever stuff</td></tr>
<tr><td class="h">801</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line =~ s/^.*(?&lt;![a-z])(tar|p7zip|unzip|ar|rpm2cpio|sh)\s+[^\s]+\s+//;</td></tr>
<tr><td class="h">802</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# need to know preceeding character - should be safe to assume it&#39;s either</td></tr>
<tr><td class="h">803</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# a slash or a space</td></tr>
<tr><td class="h">804</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $initial = $line =~ qr|/| ? &#39;/&#39; : &#39; &#39;;</td></tr>
<tr><td class="h">805</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# get rid of initial path info</td></tr>
<tr><td class="h">806</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line =~ s|^\$[^/]+/||;</td></tr>
<tr><td class="h">807</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# convert any instances of command substitution to [^-]+</td></tr>
<tr><td class="h">808</td><td><div class="c3">1530</div><div class="c3">1530</div><div class="c3">1530</div></td><td></td><td></td><td><div class="c3"><a href="SBO-Lib-lib-SBO-Lib-pm--subroutine.html#L808">1530</a></div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line =~ s/\$\([^)]+\)/[^-]+/g;</td></tr>
<tr><td class="h">809</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# convert any bash variables to [^-]+</td></tr>
<tr><td class="h">810</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line =~ s/\$({|)[A-Za-z0-9_]+(}|)/[^-]+/g;</td></tr>
<tr><td class="h">811</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# get rid of anything excess at the end</td></tr>
<tr><td class="h">812</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line =~ s/\s+.*$//;</td></tr>
<tr><td class="h">813</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# fix .?z* at the end</td></tr>
<tr><td class="h">814</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line =~ s/\.\?z\*/\.[a-z]z.*/;</td></tr>
<tr><td class="h">815</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# return what&#39;s left as a regex</td></tr>
<tr><td class="h">816</td><td><div class="c3">1530</div><div class="c3">1530</div><div class="c3">1530</div></td><td></td><td></td><td><div class="c3"><a href="SBO-Lib-lib-SBO-Lib-pm--subroutine.html#L816">1530</a></div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $regex = qr/$initial$line/;</td></tr>
<tr><td class="h">817</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $regex, $initial;</td></tr>
<tr><td class="h">818</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">819</td><td colspan="5"></td></tr><tr><td class="h">820</td><td></td><td></td><td></td><td></td><td class="s"># make a backup of the existent SlackBuild, and rewrite the original as needed</td></tr>
<tr><td class="h">821</td><td></td><td></td><td></td><td></td><td class="s">sub rewrite_slackbuild {</td></tr>
<tr><td class="h">822</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my %args = (</td></tr>
<tr><td class="h">823</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SBO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; &#39;&#39;,</td></tr>
<tr><td class="h">824</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SLACKBUILD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; &#39;&#39;,</td></tr>
<tr><td class="h">825</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGES&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; {}, </td></tr>
<tr><td class="h">826</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 0,</td></tr>
<tr><td class="h">827</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_</td></tr>
<tr><td class="h">828</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">829</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$args{SLACKBUILD} or script_error(&#39;rewrite_slackbuild requires SLACKBUILD.&#39;);</td></tr>
<tr><td class="h">830</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $slackbuild = $args{SLACKBUILD};</td></tr>
<tr><td class="h">831</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $changes = $args{CHANGES};</td></tr>
<tr><td class="h">832</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless (copy($slackbuild, &quot;$slackbuild.orig&quot;)) {</td></tr>
<tr><td class="h">833</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &quot;Unable to backup $slackbuild to $slackbuild.orig\n&quot;,</td></tr>
<tr><td class="h">834</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_ERR_OPENFH;</td></tr>
<tr><td class="h">835</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">836</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $libdir_regex = qr/^\s*LIBDIRSUFFIX=&quot;64&quot;\s*$/;</td></tr>
<tr><td class="h">837</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $arch_regex = qr/\$VERSION-\$ARCH-\$BUILD/;</td></tr>
<tr><td class="h">838</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $dc_regex = qr/(?&lt;![a-z])(tar|p7zip|unzip|ar|rpm2cpio|sh)\s+/;</td></tr>
<tr><td class="h">839</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $make_regex = qr/^\s*make\s*$/;</td></tr>
<tr><td class="h">840</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# tie the slackbuild, because this is the easiest way to handle this.</td></tr>
<tr><td class="h">841</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tie my @sb_file, &#39;Tie::File&#39;, $slackbuild;</td></tr>
<tr><td class="h">842</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# if we&#39;re dealing with a compat32, we need to change the tar line(s) so</td></tr>
<tr><td class="h">843</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# that the 32-bit source is untarred</td></tr>
<tr><td class="h">844</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($args{C32}) {</td></tr>
<tr><td class="h">845</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $location = get_sbo_location($args{SBO});</td></tr>
<tr><td class="h">846</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $downloads = get_sbo_downloads(</td></tr>
<tr><td class="h">847</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOCATION =&gt; $location,</td></tr>
<tr><td class="h">848</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;32 =&gt; 1,</td></tr>
<tr><td class="h">849</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">850</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $fns = get_dl_fns([keys %$downloads]);</td></tr>
<tr><td class="h">851</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for my $line (@sb_file) {</td></tr>
<tr><td class="h">852</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($line =~ $dc_regex) {</td></tr>
<tr><td class="h">853</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($regex, $initial) = get_dc_regex($line);</td></tr>
<tr><td class="h">854</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for my $fn (@$fns) {</td></tr>
<tr><td class="h">855</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$fn = &quot;$initial$fn&quot;;</td></tr>
<tr><td class="h">856</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line =~ s/$regex/$fn/ if $fn =~ $regex;</td></tr>
<tr><td class="h">857</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">858</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">859</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">860</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">861</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for my $line (@sb_file) {</td></tr>
<tr><td class="h">862</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# then check for and apply any other %$changes</td></tr>
<tr><td class="h">863</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (exists $$changes{libdirsuffix}) {</td></tr>
<tr><td class="h">864</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line =~ s/64/$$changes{libdirsuffix}/ if $line =~ $libdir_regex;</td></tr>
<tr><td class="h">865</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">866</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (exists $$changes{arch_out}) {</td></tr>
<tr><td class="h">867</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line =~ s/\$ARCH/$$changes{arch_out}/ if $line =~ $arch_regex;</td></tr>
<tr><td class="h">868</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">869</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (exists $changes-&gt;{jobs}) {</td></tr>
<tr><td class="h">870</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line =~ s/make/make \$MAKEOPTS/ if $line =~ $make_regex;</td></tr>
<tr><td class="h">871</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">872</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">873</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;untie @sb_file;</td></tr>
<tr><td class="h">874</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 1;</td></tr>
<tr><td class="h">875</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">876</td><td colspan="5"></td></tr><tr><td class="h">877</td><td></td><td></td><td></td><td></td><td class="s"># move a backed-up .SlackBuild file back into place</td></tr>
<tr><td class="h">878</td><td></td><td></td><td></td><td></td><td class="s">sub revert_slackbuild {</td></tr>
<tr><td class="h">879</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_ == 1 or script_error(&#39;revert_slackbuild requires an argument&#39;);</td></tr>
<tr><td class="h">880</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $slackbuild = shift;</td></tr>
<tr><td class="h">881</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (-f &quot;$slackbuild.orig&quot;) {</td></tr>
<tr><td class="h">882</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unlink $slackbuild if -f $slackbuild;</td></tr>
<tr><td class="h">883</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rename &quot;$slackbuild.orig&quot;, $slackbuild;</td></tr>
<tr><td class="h">884</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">885</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 1;</td></tr>
<tr><td class="h">886</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">887</td><td colspan="5"></td></tr><tr><td class="h">888</td><td></td><td></td><td></td><td></td><td class="s"># for the given location, pull list of downloads and check to see if any exist;</td></tr>
<tr><td class="h">889</td><td></td><td></td><td></td><td></td><td class="s"># if so, verify they md5 correctly and if not, download them and check the new</td></tr>
<tr><td class="h">890</td><td></td><td></td><td></td><td></td><td class="s"># download&#39;s md5sum, then create required symlinks for them.</td></tr>
<tr><td class="h">891</td><td></td><td></td><td></td><td></td><td class="s">sub check_distfiles {</td></tr>
<tr><td class="h">892</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my %args = (</td></tr>
<tr><td class="h">893</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOCATION =&gt; &#39;&#39;,</td></tr>
<tr><td class="h">894</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMPAT32 =&gt; 0,</td></tr>
<tr><td class="h">895</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_</td></tr>
<tr><td class="h">896</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">897</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$args{LOCATION} or script_error(&#39;check_distfiles requires LOCATION.&#39;);</td></tr>
<tr><td class="h">898</td><td colspan="5"></td></tr><tr><td class="h">899</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $location = $args{LOCATION};</td></tr>
<tr><td class="h">900</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $sbo = get_sbo_from_loc($location);</td></tr>
<tr><td class="h">901</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $downloads = get_sbo_downloads(</td></tr>
<tr><td class="h">902</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOCATION =&gt; $location,</td></tr>
<tr><td class="h">903</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;32 =&gt; $args{COMPAT32}</td></tr>
<tr><td class="h">904</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">905</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# return an error if we&#39;re unable to get download info</td></tr>
<tr><td class="h">906</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless (keys %$downloads &gt; 0) {</td></tr>
<tr><td class="h">907</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &quot;Unable to get download info from $location/$sbo.info\n&quot;,</td></tr>
<tr><td class="h">908</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_ERR_NOINFO;</td></tr>
<tr><td class="h">909</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">910</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for my $link (keys %$downloads) {</td></tr>
<tr><td class="h">911</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $md5 = $downloads-&gt;{$link};</td></tr>
<tr><td class="h">912</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless (verify_distfile($link, $md5)) {</td></tr>
<tr><td class="h">913</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($fail, $exit) = get_distfile($link, $md5);</td></tr>
<tr><td class="h">914</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $fail, $exit if $exit;</td></tr>
<tr><td class="h">915</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">916</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">917</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $symlinks = create_symlinks($args{LOCATION}, $downloads);</td></tr>
<tr><td class="h">918</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $symlinks;</td></tr>
<tr><td class="h">919</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">920</td><td colspan="5"></td></tr><tr><td class="h">921</td><td></td><td></td><td></td><td></td><td class="s"># given a location and a list of download links, assemble a list of symlinks,</td></tr>
<tr><td class="h">922</td><td></td><td></td><td></td><td></td><td class="s"># and create them.</td></tr>
<tr><td class="h">923</td><td></td><td></td><td></td><td></td><td class="s">sub create_symlinks {</td></tr>
<tr><td class="h">924</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_ == 2 or script_error(&#39;create_symlinks requires two arguments.&#39;);</td></tr>
<tr><td class="h">925</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($location, $downloads) = @_;</td></tr>
<tr><td class="h">926</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @symlinks;</td></tr>
<tr><td class="h">927</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for my $link (keys %$downloads) {</td></tr>
<tr><td class="h">928</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $filename = get_filename_from_link($link);</td></tr>
<tr><td class="h">929</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $symlink = get_symlink_from_filename($filename, $location);</td></tr>
<tr><td class="h">930</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @symlinks, $symlink;</td></tr>
<tr><td class="h">931</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;symlink $filename, $symlink;</td></tr>
<tr><td class="h">932</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">933</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return \@symlinks;</td></tr>
<tr><td class="h">934</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">935</td><td colspan="5"></td></tr><tr><td class="h">936</td><td></td><td></td><td></td><td></td><td class="s"># pull the created package name from the temp file we tee&#39;d to</td></tr>
<tr><td class="h">937</td><td></td><td></td><td></td><td></td><td class="s">sub get_pkg_name {</td></tr>
<tr><td class="h">938</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $fh = shift;</td></tr>
<tr><td class="h">939</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;seek $fh, 0, 0;</td></tr>
<tr><td class="h">940</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $regex = qr/^Slackware\s+package\s+([^\s]+)\s+created\.$/;</td></tr>
<tr><td class="h">941</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $out;</td></tr>
<tr><td class="h">942</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FIRST: while (my $line = &lt;$fh&gt;) {</td></tr>
<tr><td class="h">943</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;last FIRST if $out = ($line =~ $regex)[0];</td></tr>
<tr><td class="h">944</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">945</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $out;</td></tr>
<tr><td class="h">946</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">947</td><td colspan="5"></td></tr><tr><td class="h">948</td><td></td><td></td><td></td><td></td><td class="s">sub get_src_dir {</td></tr>
<tr><td class="h">949</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_ == 1 or script_error(&#39;get_src_dir requires an argument&#39;);</td></tr>
<tr><td class="h">950</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $fh = shift;</td></tr>
<tr><td class="h">951</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @src_dirs;</td></tr>
<tr><td class="h">952</td><td><div class="c3">12</div></td><td><div class="c0" title="T/-"><a href="SBO-Lib-lib-SBO-Lib-pm--branch.html#L952">50</a></div></td><td></td><td><div class="c3"><a href="SBO-Lib-lib-SBO-Lib-pm--subroutine.html#L952">12</a></div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# scripts use either $TMP or /tmp/SBo</td></tr>
<tr><td class="h">953</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (opendir(my $tsbo_dh, $tmpd)) {</td></tr>
<tr><td class="h">954</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FIRST: while (my $ls = readdir $tsbo_dh) {</td></tr>
<tr><td class="h">955</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next FIRST if in($ls =&gt; qw/ . .. /, qr/^package-/);</td></tr>
<tr><td class="h">956</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next FIRST unless -d &quot;$tmpd/$ls&quot;;</td></tr>
<tr><td class="h">957</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $found = 0;</td></tr>
<tr><td class="h">958</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;seek $fh, 0, 0;</td></tr>
<tr><td class="h">959</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SECOND: while (my $line = &lt;$fh&gt;) {</td></tr>
<tr><td class="h">960</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chomp ($line);</td></tr>
<tr><td class="h">961</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($line eq $ls) {</td></tr>
<tr><td class="h">962</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$found++;</td></tr>
<tr><td class="h">963</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;last SECOND;</td></tr>
<tr><td class="h">964</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">965</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">966</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @src_dirs, $ls unless $found;</td></tr>
<tr><td class="h">967</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">968</td><td><div class="c3">12</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close $tsbo_dh;</td></tr>
<tr><td class="h">969</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">970</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close $fh;</td></tr>
<tr><td class="h">971</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return \@src_dirs;</td></tr>
<tr><td class="h">972</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">973</td><td colspan="5"></td></tr><tr><td class="h">974</td><td></td><td></td><td></td><td></td><td class="s"># return a filename from a temp fh for use externally</td></tr>
<tr><td class="h">975</td><td></td><td></td><td></td><td></td><td class="s">sub get_tmp_extfn {</td></tr>
<tr><td class="h">976</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_ == 1 or script_error(&#39;get_tmp_extfn requires an argument.&#39;);</td></tr>
<tr><td class="h">977</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $fh = shift;</td></tr>
<tr><td class="h">978</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless (fcntl($fh, F_SETFD, 0)) {</td></tr>
<tr><td class="h">979</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &quot;Can&#39;t unset exec-on-close bit.\n&quot;, _ERR_F_SETFD;</td></tr>
<tr><td class="h">980</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">981</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &#39;/dev/fd/&#39;. fileno $fh;</td></tr>
<tr><td class="h">982</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">983</td><td colspan="5"></td></tr><tr><td class="h">984</td><td></td><td></td><td></td><td></td><td class="s"># prep and run .SlackBuild</td></tr>
<tr><td class="h">985</td><td></td><td></td><td></td><td></td><td class="s">sub perform_sbo {</td></tr>
<tr><td class="h">986</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my %args = (</td></tr>
<tr><td class="h">987</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OPTS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 0,</td></tr>
<tr><td class="h">988</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JOBS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 0,</td></tr>
<tr><td class="h">989</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOCATION&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; &#39;&#39;,</td></tr>
<tr><td class="h">990</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ARCH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; &#39;&#39;,</td></tr>
<tr><td class="h">991</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 0,</td></tr>
<tr><td class="h">992</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;X32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 0,</td></tr>
<tr><td class="h">993</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_</td></tr>
<tr><td class="h">994</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">995</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless ($args{LOCATION} &amp;&amp; $args{ARCH}) {</td></tr>
<tr><td class="h">996</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;script_error(&#39;perform_sbo requires LOCATION and ARCH.&#39;);</td></tr>
<tr><td class="h">997</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">998</td><td colspan="5"></td></tr><tr><td class="h">999</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $location = $args{LOCATION};</td></tr>
<tr><td class="h">1000</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $sbo = get_sbo_from_loc($location);</td></tr>
<tr><td class="h">1001</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($cmd, %changes);</td></tr>
<tr><td class="h">1002</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# set any changes we need to make to the .SlackBuild, setup the command</td></tr>
<tr><td class="h">1003</td><td colspan="5"></td></tr><tr><td class="h">1004</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cmd = &#39;( &#39;;</td></tr>
<tr><td class="h">1005</td><td colspan="5"></td></tr><tr><td class="h">1006</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($args{ARCH} eq &#39;x86_64&#39; and ($args{C32} || $args{X32})) {</td></tr>
<tr><td class="h">1007</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($args{C32}) {</td></tr>
<tr><td class="h">1008</td><td><div class="c3">20</div></td><td></td><td></td><td><div class="c3"><a href="SBO-Lib-lib-SBO-Lib-pm--subroutine.html#L1008">20</a></div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$changes{libdirsuffix} = &#39;&#39;;</td></tr>
<tr><td class="h">1009</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ($args{X32}) {</td></tr>
<tr><td class="h">1010</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$changes{arch_out} = &#39;i486&#39;;</td></tr>
<tr><td class="h">1011</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1012</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cmd .= &#39;. /etc/profile.d/32dev.sh &amp;&amp;&#39;;</td></tr>
<tr><td class="h">1013</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1014</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($args{JOBS} and $args{JOBS} ne &#39;FALSE&#39;) {</td></tr>
<tr><td class="h">1015</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$changes{jobs} = 1;</td></tr>
<tr><td class="h">1016</td><td><div class="c3">20</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1017</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cmd .= &quot; $args{OPTS}&quot; if $args{OPTS};</td></tr>
<tr><td class="h">1018</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cmd .= &quot; MAKEOPTS=\&quot;-j$args{JOBS}\&quot;&quot; if $args{JOBS};</td></tr>
<tr><td class="h">1019</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# we need to get a listing of /tmp/SBo, or $TMP, if we can, before we run</td></tr>
<tr><td class="h">1020</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# the SlackBuild so that we can compare to a listing taken afterward.</td></tr>
<tr><td class="h">1021</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $src_ls_fh = tempfile(DIR =&gt; $tempdir);</td></tr>
<tr><td class="h">1022</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (opendir(my $tsbo_dh, $tmpd)) {</td></tr>
<tr><td class="h">1023</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FIRST: while (my $dir = readdir $tsbo_dh) {</td></tr>
<tr><td class="h">1024</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next FIRST if in($dir =&gt; qw/ . .. /);</td></tr>
<tr><td class="h">1025</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;say {$src_ls_fh} $dir;</td></tr>
<tr><td class="h">1026</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1027</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1028</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# get a tempfile to store the exit status of the slackbuild</td></tr>
<tr><td class="h">1029</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $exit_temp = tempfile(DIR =&gt; $tempdir);</td></tr>
<tr><td class="h">1030</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($exit_fn, $exit) = get_tmp_extfn($exit_temp);</td></tr>
<tr><td class="h">1031</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $exit_fn, undef, $exit if $exit;</td></tr>
<tr><td class="h">1032</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# set TMP/OUTPUT if set in the environment</td></tr>
<tr><td class="h">1033</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cmd .= &quot; TMP=$env_tmp&quot; if $env_tmp;</td></tr>
<tr><td class="h">1034</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cmd .= &quot; OUTPUT=$ENV{OUTPUT}&quot; if defined $ENV{OUTPUT};</td></tr>
<tr><td class="h">1035</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cmd .= &quot; /bin/bash $location/$sbo.SlackBuild; echo \$? &gt; $exit_fn )&quot;;</td></tr>
<tr><td class="h">1036</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $tempfh = tempfile(DIR =&gt; $tempdir);</td></tr>
<tr><td class="h">1037</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $fn;</td></tr>
<tr><td class="h">1038</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;($fn, $exit) = get_tmp_extfn($tempfh);</td></tr>
<tr><td class="h">1039</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $fn, undef, $exit if $exit;</td></tr>
<tr><td class="h">1040</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cmd .= &quot; | tee -a $fn&quot;;</td></tr>
<tr><td class="h">1041</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# attempt to rewrite the slackbuild, or exit if we can&#39;t</td></tr>
<tr><td class="h">1042</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $fail;</td></tr>
<tr><td class="h">1043</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;($fail, $exit) = rewrite_slackbuild(</td></tr>
<tr><td class="h">1044</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SBO =&gt; $sbo,</td></tr>
<tr><td class="h">1045</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SLACKBUILD =&gt; &quot;$location/$sbo.SlackBuild&quot;,</td></tr>
<tr><td class="h">1046</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGES =&gt; \%changes,</td></tr>
<tr><td class="h">1047</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C32 =&gt; $args{C32},</td></tr>
<tr><td class="h">1048</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">1049</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $fail, undef, $exit if $exit;</td></tr>
<tr><td class="h">1050</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# run the slackbuild, grab its exit status, revert our changes</td></tr>
<tr><td class="h">1051</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chdir $location, system $cmd;</td></tr>
<tr><td class="h">1052</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;seek $exit_temp, 0, 0;</td></tr>
<tr><td class="h">1053</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $out = do {local $/; &lt;$exit_temp&gt;};</td></tr>
<tr><td class="h">1054</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close $exit_temp;</td></tr>
<tr><td class="h">1055</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;revert_slackbuild(&quot;$location/$sbo.SlackBuild&quot;);</td></tr>
<tr><td class="h">1056</td><td><div class="c3">12117</div></td><td><div class="c0" title="-/F"><a href="SBO-Lib-lib-SBO-Lib-pm--branch.html#L1056">50</a></div></td><td></td><td><div class="c3"><a href="SBO-Lib-lib-SBO-Lib-pm--subroutine.html#L1056">12117</a></div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# return error now if the slackbuild didn&#39;t exit 0</td></tr>
<tr><td class="h">1057</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &quot;$sbo.SlackBuild return non-zero\n&quot;, undef, _ERR_BUILD if $out != 0;</td></tr>
<tr><td class="h">1058</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $pkg = get_pkg_name($tempfh);</td></tr>
<tr><td class="h">1059</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &quot;$sbo.SlackBuild didn&#39;t create a package\n&quot;, undef, _ERR_BUILD if not defined $pkg;</td></tr>
<tr><td class="h">1060</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $src = get_src_dir($src_ls_fh);</td></tr>
<tr><td class="h">1061</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $pkg, $src;</td></tr>
<tr><td class="h">1062</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1063</td><td colspan="5"></td></tr><tr><td class="h">1064</td><td><div class="c3">12117</div></td><td><div class="c3" title="T/F"><a href="SBO-Lib-lib-SBO-Lib-pm--branch.html#L1064">100</a></div></td><td></td><td></td><td class="s"># run convertpkg on a package to turn it into a -compat32 thing</td></tr>
<tr><td class="h">1065</td><td></td><td></td><td></td><td></td><td class="s">sub do_convertpkg {</td></tr>
<tr><td class="h">1066</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_ == 1 or script_error(&#39;do_convertpkg requires an argument.&#39;);</td></tr>
<tr><td class="h">1067</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $pkg = shift;</td></tr>
<tr><td class="h">1068</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $tempfh = tempfile(DIR =&gt; $tempdir);</td></tr>
<tr><td class="h">1069</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $fn = get_tmp_extfn($tempfh);</td></tr>
<tr><td class="h">1070</td><td colspan="5"></td></tr><tr><td class="h">1071</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# get a tempfile to store the exit status of the slackbuild</td></tr>
<tr><td class="h">1072</td><td><div class="c3">11781</div></td><td><div class="c3" title="T/F"><a href="SBO-Lib-lib-SBO-Lib-pm--branch.html#L1072">100</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $exit_temp = tempfile(DIR =&gt; $tempdir);</td></tr>
<tr><td class="h">1073</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($exit_fn, $exit) = get_tmp_extfn($exit_temp);</td></tr>
<tr><td class="h">1074</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $exit_fn, undef, $exit if $exit;</td></tr>
<tr><td class="h">1075</td><td colspan="5"></td></tr><tr><td class="h">1076</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $c32tmpd = $env_tmp // &#39;/tmp&#39;;</td></tr>
<tr><td class="h">1077</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $cmd = &quot;( /bin/bash -c &#39;/usr/sbin/convertpkg-compat32 -i $pkg -d $c32tmpd&#39;; echo \$? &gt; $exit_fn ) | tee $fn&quot;;</td></tr>
<tr><td class="h">1078</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $ret = system(&#39;/bin/bash&#39;, &#39;-c&#39;, $cmd);</td></tr>
<tr><td class="h">1079</td><td colspan="5"></td></tr><tr><td class="h">1080</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# If the system call worked, check the saved exit status</td></tr>
<tr><td class="h">1081</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;seek $exit_temp, 0, 0;</td></tr>
<tr><td class="h">1082</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret = do {local $/; &lt;$exit_temp&gt;} if $ret == 0;</td></tr>
<tr><td class="h">1083</td><td colspan="5"></td></tr><tr><td class="h">1084</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($ret != 0) {</td></tr>
<tr><td class="h">1085</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &quot;convertpkg-compt32 returned non-zero exit status\n&quot;,</td></tr>
<tr><td class="h">1086</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_ERR_CONVERTPKG;</td></tr>
<tr><td class="h">1087</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1088</td><td><div class="c3">12105</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unlink $pkg;</td></tr>
<tr><td class="h">1089</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return get_pkg_name($tempfh);</td></tr>
<tr><td class="h">1090</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1091</td><td colspan="5"></td></tr><tr><td class="h">1092</td><td></td><td></td><td></td><td></td><td class="s"># &quot;public interface&quot;, sort of thing.</td></tr>
<tr><td class="h">1093</td><td></td><td></td><td></td><td></td><td class="s">sub do_slackbuild {</td></tr>
<tr><td class="h">1094</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my %args = (</td></tr>
<tr><td class="h">1095</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OPTS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 0,</td></tr>
<tr><td class="h">1096</td><td><div class="c3">12105</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JOBS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 0,</td></tr>
<tr><td class="h">1097</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOCATION&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; &#39;&#39;,</td></tr>
<tr><td class="h">1098</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMPAT32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 0,</td></tr>
<tr><td class="h">1099</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_</td></tr>
<tr><td class="h">1100</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">1101</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$args{LOCATION} or script_error(&#39;do_slackbuild requires LOCATION.&#39;);</td></tr>
<tr><td class="h">1102</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $location = $args{LOCATION};</td></tr>
<tr><td class="h">1103</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $sbo = get_sbo_from_loc($location);</td></tr>
<tr><td class="h">1104</td><td><div class="c3">12105</div></td><td><div class="c0" title="-/F"><a href="SBO-Lib-lib-SBO-Lib-pm--branch.html#L1104">50</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $arch = get_arch();</td></tr>
<tr><td class="h">1105</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $multilib = check_multilib();</td></tr>
<tr><td class="h">1106</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $version = get_sbo_version($location);</td></tr>
<tr><td class="h">1107</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $x32;</td></tr>
<tr><td class="h">1108</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# ensure x32 stuff is set correctly, or that we&#39;re setup for it</td></tr>
<tr><td class="h">1109</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($args{COMPAT32}) {</td></tr>
<tr><td class="h">1110</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless ($multilib) {</td></tr>
<tr><td class="h">1111</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &quot;compat32 requires multilib.\n&quot;, (undef) x 2,</td></tr>
<tr><td class="h">1112</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_ERR_NOMULTILIB;</td></tr>
<tr><td class="h">1113</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1114</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless (-f &#39;/usr/sbin/convertpkg-compat32&#39;) {</td></tr>
<tr><td class="h">1115</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &quot;compat32 requires /usr/sbin/convertpkg-compat32.\n&quot;,</td></tr>
<tr><td class="h">1116</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(undef) x 2, _ERR_NOCONVERTPKG;</td></tr>
<tr><td class="h">1117</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1118</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1119</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($arch eq &#39;x86_64&#39;) {</td></tr>
<tr><td class="h">1120</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$x32 = check_x32 $args{LOCATION};</td></tr>
<tr><td class="h">1121</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($x32 &amp;&amp; ! $multilib) {</td></tr>
<tr><td class="h">1122</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $warn =</td></tr>
<tr><td class="h">1123</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;$sbo is 32-bit which requires multilib on x86_64.\n&quot;;</td></tr>
<tr><td class="h">1124</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $warn, (undef) x 2, _ERR_NOMULTILIB;</td></tr>
<tr><td class="h">1125</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1126</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1127</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1128</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# setup and run the .SlackBuild itself</td></tr>
<tr><td class="h">1129</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($pkg, $src, $exit) = perform_sbo(</td></tr>
<tr><td class="h">1130</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OPTS =&gt; $args{OPTS},</td></tr>
<tr><td class="h">1131</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JOBS =&gt; $args{JOBS},</td></tr>
<tr><td class="h">1132</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOCATION =&gt; $location,</td></tr>
<tr><td class="h">1133</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ARCH =&gt; $arch,</td></tr>
<tr><td class="h">1134</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C32 =&gt; $args{COMPAT32},</td></tr>
<tr><td class="h">1135</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;X32 =&gt; $x32,</td></tr>
<tr><td class="h">1136</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">1137</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $pkg, (undef) x 2, $exit if $exit;</td></tr>
<tr><td class="h">1138</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($args{COMPAT32}) {</td></tr>
<tr><td class="h">1139</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;($pkg, $exit) = do_convertpkg($pkg);</td></tr>
<tr><td class="h">1140</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $pkg, (undef) x 2, $exit if $exit;</td></tr>
<tr><td class="h">1141</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1142</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $version, $pkg, $src;</td></tr>
<tr><td class="h">1143</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1144</td><td colspan="5"></td></tr><tr><td class="h">1145</td><td></td><td></td><td></td><td></td><td class="s"># remove work directories (source and packaging dirs under /tmp/SBo or $TMP and /tmp or $OUTPUT)</td></tr>
<tr><td class="h">1146</td><td></td><td></td><td></td><td></td><td class="s">sub make_clean {</td></tr>
<tr><td class="h">1147</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my %args = (</td></tr>
<tr><td class="h">1148</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SBO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; &#39;&#39;,</td></tr>
<tr><td class="h">1149</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SRC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; &#39;&#39;,</td></tr>
<tr><td class="h">1150</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VERSION =&gt; &#39;&#39;,</td></tr>
<tr><td class="h">1151</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_</td></tr>
<tr><td class="h">1152</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">1153</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless ($args{SBO} &amp;&amp; $args{SRC} &amp;&amp; $args{VERSION}) {</td></tr>
<tr><td class="h">1154</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;script_error(&#39;make_clean requires three arguments.&#39;);</td></tr>
<tr><td class="h">1155</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1156</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $src = $args{SRC};</td></tr>
<tr><td class="h">1157</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;say &quot;Cleaning for $args{SBO}-$args{VERSION}...&quot;;</td></tr>
<tr><td class="h">1158</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for my $dir (@$src) {</td></tr>
<tr><td class="h">1159</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remove_tree(&quot;$tmpd/$dir&quot;) if -d &quot;$tmpd/$dir&quot;;</td></tr>
<tr><td class="h">1160</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1161</td><td colspan="5"></td></tr><tr><td class="h">1162</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $output = $ENV{OUTPUT} // &#39;/tmp&#39;;</td></tr>
<tr><td class="h">1163</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remove_tree(&quot;$output/package-$args{SBO}&quot;) if</td></tr>
<tr><td class="h">1164</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-d &quot;$output/package-$args{SBO}&quot;;</td></tr>
<tr><td class="h">1165</td><td colspan="5"></td></tr><tr><td class="h">1166</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($args{SBO} =~ /^(.+)-compat32$/) {</td></tr>
<tr><td class="h">1167</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $pkg_name = $1;</td></tr>
<tr><td class="h">1168</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remove_tree(&quot;/tmp/package-$args{SBO}&quot;) if</td></tr>
<tr><td class="h">1169</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;not defined $env_tmp and</td></tr>
<tr><td class="h">1170</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-d &quot;/tmp/package-$args{SBO}&quot;;</td></tr>
<tr><td class="h">1171</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remove_tree(&quot;$tmpd/package-$pkg_name&quot;) if</td></tr>
<tr><td class="h">1172</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-d &quot;$tmpd/package-$pkg_name&quot;;</td></tr>
<tr><td class="h">1173</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1174</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 1;</td></tr>
<tr><td class="h">1175</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1176</td><td colspan="5"></td></tr><tr><td class="h">1177</td><td></td><td></td><td></td><td></td><td class="s"># remove distfiles</td></tr>
<tr><td class="h">1178</td><td></td><td></td><td></td><td></td><td class="s">sub make_distclean {</td></tr>
<tr><td class="h">1179</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my %args = (</td></tr>
<tr><td class="h">1180</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SRC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; &#39;&#39;,</td></tr>
<tr><td class="h">1181</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VERSION&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; &#39;&#39;,</td></tr>
<tr><td class="h">1182</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOCATION&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; &#39;&#39;,</td></tr>
<tr><td class="h">1183</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_</td></tr>
<tr><td class="h">1184</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">1185</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless ($args{SRC} &amp;&amp; $args{VERSION} &amp;&amp; $args{LOCATION}) {</td></tr>
<tr><td class="h">1186</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;script_error(&#39;make_distclean requires four arguments.&#39;);</td></tr>
<tr><td class="h">1187</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1188</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $sbo = get_sbo_from_loc($args{LOCATION});</td></tr>
<tr><td class="h">1189</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;make_clean(SBO =&gt; $sbo, SRC =&gt; $args{SRC}, VERSION =&gt; $args{VERSION});</td></tr>
<tr><td class="h">1190</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;say &quot;Distcleaning for $sbo-$args{VERSION}...&quot;;</td></tr>
<tr><td class="h">1191</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# remove any distfiles for this particular SBo.</td></tr>
<tr><td class="h">1192</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $downloads = get_sbo_downloads(LOCATION =&gt; $args{LOCATION});</td></tr>
<tr><td class="h">1193</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for my $key (keys %$downloads) {</td></tr>
<tr><td class="h">1194</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $filename = get_filename_from_link($key);</td></tr>
<tr><td class="h">1195</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unlink $filename if -f $filename;</td></tr>
<tr><td class="h">1196</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1197</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 1;</td></tr>
<tr><td class="h">1198</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1199</td><td colspan="5"></td></tr><tr><td class="h">1200</td><td></td><td></td><td></td><td></td><td class="s"># run upgradepkg for a created package</td></tr>
<tr><td class="h">1201</td><td></td><td></td><td></td><td></td><td class="s">sub do_upgradepkg {</td></tr>
<tr><td class="h">1202</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_ == 1 or script_error(&#39;do_upgradepkg requires an argument.&#39;);</td></tr>
<tr><td class="h">1203</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;system(&#39;/sbin/upgradepkg&#39;, &#39;--reinstall&#39;, &#39;--install-new&#39;, shift);</td></tr>
<tr><td class="h">1204</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 1;</td></tr>
<tr><td class="h">1205</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1206</td><td colspan="5"></td></tr><tr><td class="h">1207</td><td></td><td></td><td></td><td></td><td class="s"># wrapper to pull the list of requirements for a given sbo</td></tr>
<tr><td class="h">1208</td><td></td><td></td><td></td><td></td><td class="s">sub get_requires {</td></tr>
<tr><td class="h">1209</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $location = get_sbo_location(shift);</td></tr>
<tr><td class="h">1210</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return() unless $location;</td></tr>
<tr><td class="h">1211</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $info = get_from_info(LOCATION =&gt; $location, GET =&gt; &#39;REQUIRES&#39;);</td></tr>
<tr><td class="h">1212</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $info;</td></tr>
<tr><td class="h">1213</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1214</td><td colspan="5"></td></tr><tr><td class="h">1215</td><td></td><td></td><td></td><td></td><td class="s">sub uniq {</td></tr>
<tr><td class="h">1216</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my %seen;</td></tr>
<tr><td class="h">1217</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return grep { !$seen{$_}++ } @_;</td></tr>
<tr><td class="h">1218</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1219</td><td colspan="5"></td></tr><tr><td class="h">1220</td><td></td><td></td><td></td><td></td><td class="s">sub _build_queue {</td></tr>
<tr><td class="h">1221</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($sbos, $warnings) = @_;</td></tr>
<tr><td class="h">1222</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @queue = @$sbos;</td></tr>
<tr><td class="h">1223</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @result;</td></tr>
<tr><td class="h">1224</td><td colspan="5"></td></tr><tr><td class="h">1225</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while (my $sbo = shift @queue) {</td></tr>
<tr><td class="h">1226</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next if $sbo eq &quot;%README%&quot;;</td></tr>
<tr><td class="h">1227</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $reqs = get_requires($sbo);</td></tr>
<tr><td class="h">1228</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (defined $reqs) {</td></tr>
<tr><td class="h">1229</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @result, _build_queue($reqs, $warnings);</td></tr>
<tr><td class="h">1230</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $req (@$reqs) {</td></tr>
<tr><td class="h">1231</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$warnings-&gt;{$sbo}=&quot;%README%&quot; if $req eq &quot;%README%&quot;;</td></tr>
<tr><td class="h">1232</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1233</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1234</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @result, $sbo;</td></tr>
<tr><td class="h">1235</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1236</td><td colspan="5"></td></tr><tr><td class="h">1237</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return uniq @result;</td></tr>
<tr><td class="h">1238</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1239</td><td colspan="5"></td></tr><tr><td class="h">1240</td><td></td><td></td><td></td><td></td><td class="s">sub get_build_queue {</td></tr>
<tr><td class="h">1241</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_ == 2 or script_error(&#39;get_build_queue requires two arguments.&#39;);</td></tr>
<tr><td class="h">1242</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return [ _build_queue(@_) ];</td></tr>
<tr><td class="h">1243</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1244</td><td colspan="5"></td></tr><tr><td class="h">1245</td><td></td><td></td><td></td><td></td><td class="s">sub merge_queues {</td></tr>
<tr><td class="h">1246</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Usage: merge_queues(\@queue_a, \@queue_b);</td></tr>
<tr><td class="h">1247</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Results in queue_b being merged into queue_a (without duplicates)</td></tr>
<tr><td class="h">1248</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_ == 2 or script_error(&#39;merge_queues requires two arguments.&#39;);</td></tr>
<tr><td class="h">1249</td><td colspan="5"></td></tr><tr><td class="h">1250</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return [ uniq @{$_[0]}, @{$_[1]} ];</td></tr>
<tr><td class="h">1251</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1252</td><td colspan="5"></td></tr><tr><td class="h">1253</td><td></td><td></td><td></td><td></td><td class="s">sub get_readme_contents {</td></tr>
<tr><td class="h">1254</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_ == 1 or script_error(&#39;get_readme_contents requires an argument.&#39;);</td></tr>
<tr><td class="h">1255</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return undef, _ERR_OPENFH if not defined $_[0];</td></tr>
<tr><td class="h">1256</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($fh, $exit) = open_read(shift .&#39;/README&#39;);</td></tr>
<tr><td class="h">1257</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return undef, $exit if $exit;</td></tr>
<tr><td class="h">1258</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $readme = do {local $/; &lt;$fh&gt;};</td></tr>
<tr><td class="h">1259</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close $fh;</td></tr>
<tr><td class="h">1260</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $readme;</td></tr>
<tr><td class="h">1261</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1262</td><td colspan="5"></td></tr><tr><td class="h">1263</td><td></td><td></td><td></td><td></td><td class="s"># return a list of perl modules installed via the CPAN</td></tr>
<tr><td class="h">1264</td><td></td><td></td><td></td><td></td><td class="s">sub get_installed_cpans {</td></tr>
<tr><td class="h">1265</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @locals;</td></tr>
<tr><td class="h">1266</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for my $dir (@INC) {</td></tr>
<tr><td class="h">1267</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @locals, &quot;$dir/perllocal.pod&quot; if -f &quot;$dir/perllocal.pod&quot;;</td></tr>
<tr><td class="h">1268</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1269</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @contents;</td></tr>
<tr><td class="h">1270</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for my $file (@locals) {</td></tr>
<tr><td class="h">1271</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($fh, $exit) = open_read($file);</td></tr>
<tr><td class="h">1272</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return [] if $exit;</td></tr>
<tr><td class="h">1273</td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @contents, grep {/Module|VERSION/} &lt;$fh&gt;;</td></tr>
<tr><td class="h">1274</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @contents, grep {/Module/} &lt;$fh&gt;;</td></tr>
<tr><td class="h">1275</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close $fh;</td></tr>
<tr><td class="h">1276</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1277</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $mod_regex = qr/C&lt;Module&gt;\s+L&lt;([^\|]+)/;</td></tr>
<tr><td class="h">1278</td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $ver_regex = qr/C&lt;VERSION:\s+([^&gt;]+)&gt;/;</td></tr>
<tr><td class="h">1279</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my (@mods, @vers);</td></tr>
<tr><td class="h">1280</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for my $line (@contents) {</td></tr>
<tr><td class="h">1281</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @mods, ($line =~ $mod_regex)[0];</td></tr>
<tr><td class="h">1282</td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @vers, ($line =~ $ver_regex)[0];</td></tr>
<tr><td class="h">1283</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1284</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return \@mods;</td></tr>
<tr><td class="h">1285</td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my %cpans;</td></tr>
<tr><td class="h">1286</td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cpans{$mods[$_]} = $vers[$_] for keys @mods;</td></tr>
<tr><td class="h">1287</td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return \%cpans;</td></tr>
<tr><td class="h">1288</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1289</td><td colspan="5"></td></tr><tr><td class="h">1290</td><td></td><td></td><td></td><td></td><td class="s"># look for any (user|group)add commands in the README</td></tr>
<tr><td class="h">1291</td><td></td><td></td><td></td><td></td><td class="s">sub get_user_group {</td></tr>
<tr><td class="h">1292</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_ == 1 or script_error(&#39;get_user_group requires an argument&#39;);</td></tr>
<tr><td class="h">1293</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $readme = shift;</td></tr>
<tr><td class="h">1294</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @cmds = $readme =~ /^\s*#*\s*(useradd.*|groupadd.*)/mg;</td></tr>
<tr><td class="h">1295</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return \@cmds;</td></tr>
<tr><td class="h">1296</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1297</td><td colspan="5"></td></tr><tr><td class="h">1298</td><td></td><td></td><td></td><td></td><td class="s"># offer to run any user/group add commands</td></tr>
<tr><td class="h">1299</td><td></td><td></td><td></td><td></td><td class="s">sub ask_user_group {</td></tr>
<tr><td class="h">1300</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_ == 2 or script_error(&#39;ask_user_group requires two arguments&#39;);</td></tr>
<tr><td class="h">1301</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($cmds, $readme) = @_;</td></tr>
<tr><td class="h">1302</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;say &quot;\n&quot;. $readme;</td></tr>
<tr><td class="h">1303</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print &quot;\nIt looks like this slackbuild requires the following&quot;;</td></tr>
<tr><td class="h">1304</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;say &#39; command(s) to be run first:&#39;;</td></tr>
<tr><td class="h">1305</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;say &quot;&nbsp;&nbsp;&nbsp;&nbsp;# $_&quot; for @$cmds;</td></tr>
<tr><td class="h">1306</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print &#39;Shall I run them prior to building? [y] &#39;;</td></tr>
<tr><td class="h">1307</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &lt;STDIN&gt; =~ /^[Yy\n]/ ? $cmds : undef;</td></tr>
<tr><td class="h">1308</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1309</td><td colspan="5"></td></tr><tr><td class="h">1310</td><td></td><td></td><td></td><td></td><td class="s"># see if the README mentions any options</td></tr>
<tr><td class="h">1311</td><td></td><td></td><td></td><td></td><td class="s">sub get_opts {</td></tr>
<tr><td class="h">1312</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_ == 1 or script_error(&#39;get_opts requires an argument&#39;);</td></tr>
<tr><td class="h">1313</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $readme = shift;</td></tr>
<tr><td class="h">1314</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $readme =~ /[A-Z0-9]+=[^\s]/ ? 1 : undef;</td></tr>
<tr><td class="h">1315</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1316</td><td colspan="5"></td></tr><tr><td class="h">1317</td><td></td><td></td><td></td><td></td><td class="s"># provide an opportunity to set options</td></tr>
<tr><td class="h">1318</td><td></td><td></td><td></td><td></td><td class="s">sub ask_opts {</td></tr>
<tr><td class="h">1319</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# TODO: check number of args</td></tr>
<tr><td class="h">1320</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_ &gt;= 1 or script_error(&#39;ask_opts requires an argument&#39;);</td></tr>
<tr><td class="h">1321</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($sbo, $readme) = @_;</td></tr>
<tr><td class="h">1322</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;say &quot;\n&quot;. $readme;</td></tr>
<tr><td class="h">1323</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print &quot;\nIt looks like $sbo has options; would you like to set any&quot;;</td></tr>
<tr><td class="h">1324</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print &#39; when the slackbuild is run? [n] &#39;;</td></tr>
<tr><td class="h">1325</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (&lt;STDIN&gt; =~ /^[Yy]/) {</td></tr>
<tr><td class="h">1326</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $ask = sub {</td></tr>
<tr><td class="h">1327</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print &quot;\nPlease supply any options here, or enter to skip: &quot;;</td></tr>
<tr><td class="h">1328</td><td><div class="c3">1530</div></td><td></td><td></td><td><div class="c3"><a href="SBO-Lib-lib-SBO-Lib-pm--subroutine.html#L1328">1530</a></div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chomp(my $opts = &lt;STDIN&gt;);</td></tr>
<tr><td class="h">1329</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return() if $opts =~ /^\n/;</td></tr>
<tr><td class="h">1330</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $opts;</td></tr>
<tr><td class="h">1331</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">1332</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $kv_regex = qr/[A-Z0-9]+=[^\s]+(|\s([A-Z]+=[^\s]+){0,})/;</td></tr>
<tr><td class="h">1333</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $opts = $ask-&gt;();</td></tr>
<tr><td class="h">1334</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return() unless $opts;</td></tr>
<tr><td class="h">1335</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while ($opts !~ $kv_regex) {</td></tr>
<tr><td class="h">1336</td><td><div class="c3">1530</div></td><td><div class="c3" title="T/F"><a href="SBO-Lib-lib-SBO-Lib-pm--branch.html#L1336">100</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;warn &quot;Invalid input received.\n&quot;;</td></tr>
<tr><td class="h">1337</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$opts = $ask-&gt;();</td></tr>
<tr><td class="h">1338</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1339</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $opts;</td></tr>
<tr><td class="h">1340</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1341</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return();</td></tr>
<tr><td class="h">1342</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1343</td><td colspan="5"></td></tr><tr><td class="h">1344</td><td><div class="c3">1522</div></td><td></td><td></td><td></td><td class="s"># for a given sbo, check for cmds/opts, prompt the user as appropriate</td></tr>
<tr><td class="h">1345</td><td></td><td></td><td></td><td></td><td class="s">sub user_prompt {</td></tr>
<tr><td class="h">1346</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_ == 2 or script_error(&#39;user_prompt requires two arguments.&#39;);</td></tr>
<tr><td class="h">1347</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($sbo, $location) = @_;</td></tr>
<tr><td class="h">1348</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (not defined $location) { usage_error(&quot;Unable to locate $sbo in the SlackBuilds.org tree.&quot;); }</td></tr>
<tr><td class="h">1349</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($readme, $exit) = get_readme_contents($location);</td></tr>
<tr><td class="h">1350</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (is_local($sbo)) { print &quot;\nFound $sbo in local overrides.\n&quot;; $exit = 0; }</td></tr>
<tr><td class="h">1351</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $readme, undef, $exit if $exit;</td></tr>
<tr><td class="h">1352</td><td><div class="c3">1522</div></td><td><div class="c0" title="-/F"><a href="SBO-Lib-lib-SBO-Lib-pm--branch.html#L1352">50</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# check for user/group add commands, offer to run any found</td></tr>
<tr><td class="h">1353</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $user_group = get_user_group($readme);</td></tr>
<tr><td class="h">1354</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $cmds;</td></tr>
<tr><td class="h">1355</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cmds = ask_user_group($user_group, $readme) if $$user_group[0];</td></tr>
<tr><td class="h">1356</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# check for options mentioned in the README</td></tr>
<tr><td class="h">1357</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $opts = 0;</td></tr>
<tr><td class="h">1358</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$opts = ask_opts($sbo, $readme) if get_opts($readme);</td></tr>
<tr><td class="h">1359</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print &quot;\n&quot;. $readme unless $opts;</td></tr>
<tr><td class="h">1360</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print &quot;\nProceed with $sbo? [y]: &quot;;</td></tr>
<tr><td class="h">1361</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# we have to return something substantial if the user says no so that we</td></tr>
<tr><td class="h">1362</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# can check the value of $cmds on the calling side. we should be able to</td></tr>
<tr><td class="h">1363</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# assume that &#39;N&#39; will&nbsp;&nbsp;never be a valid command to run.</td></tr>
<tr><td class="h">1364</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &#39;N&#39; unless &lt;STDIN&gt; =~ /^[Yy\n]/;</td></tr>
<tr><td class="h">1365</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $cmds, $opts;</td></tr>
<tr><td class="h">1366</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1367</td><td colspan="5"></td></tr><tr><td class="h">1368</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td class="s"># do the things with the provided sbos - whether upgrades or new installs.</td></tr>
<tr><td class="h">1369</td><td></td><td></td><td></td><td></td><td class="s">sub process_sbos {</td></tr>
<tr><td class="h">1370</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my %args = (</td></tr>
<tr><td class="h">1371</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TODO =&gt; &#39;&#39;,</td></tr>
<tr><td class="h">1372</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CMDS =&gt; &#39;&#39;,</td></tr>
<tr><td class="h">1373</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OPTS =&gt; &#39;&#39;,</td></tr>
<tr><td class="h">1374</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JOBS =&gt; &#39;FALSE&#39;,</td></tr>
<tr><td class="h">1375</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOCATIONS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; &#39;&#39;,</td></tr>
<tr><td class="h">1376</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NOINSTALL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 0,</td></tr>
<tr><td class="h">1377</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NOCLEAN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; &#39;FALSE&#39;,</td></tr>
<tr><td class="h">1378</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DISTCLEAN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; &#39;FALSE&#39;,</td></tr>
<tr><td class="h">1379</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NON_INT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 0,</td></tr>
<tr><td class="h">1380</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@_</td></tr>
<tr><td class="h">1381</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">1382</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $todo = $args{TODO};</td></tr>
<tr><td class="h">1383</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $cmds = $args{CMDS};</td></tr>
<tr><td class="h">1384</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $opts = $args{OPTS};</td></tr>
<tr><td class="h">1385</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $locs = $args{LOCATIONS};</td></tr>
<tr><td class="h">1386</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $jobs = $args{JOBS} =~ /^\d+$/ ? $args{JOBS} : 0;</td></tr>
<tr><td class="h">1387</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@$todo &gt;= 1 or script_error(&#39;process_sbos requires TODO.&#39;);</td></tr>
<tr><td class="h">1388</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my (@failures, @symlinks, $err);</td></tr>
<tr><td class="h">1389</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FIRST: for my $sbo (@$todo) {</td></tr>
<tr><td class="h">1390</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $compat32 = $sbo =~ /-compat32$/ ? 1 : 0;</td></tr>
<tr><td class="h">1391</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($temp_syms, $exit) = check_distfiles(</td></tr>
<tr><td class="h">1392</td><td><div class="c3">1522</div><div class="c3">1522</div><div class="c3">1522</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOCATION =&gt; $$locs{$sbo}, COMPAT32 =&gt; $compat32</td></tr>
<tr><td class="h">1393</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">1394</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# if $exit is defined, prompt to proceed or return with last $exit</td></tr>
<tr><td class="h">1395</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($exit) {</td></tr>
<tr><td class="h">1396</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$err = $exit;</td></tr>
<tr><td class="h">1397</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $fail = $temp_syms;</td></tr>
<tr><td class="h">1398</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @failures, {$sbo =&gt; $fail};</td></tr>
<tr><td class="h">1399</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# return now if we&#39;re not interactive</td></tr>
<tr><td class="h">1400</td><td><div class="c3">1522</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return \@failures, $exit if $args{NON_INT};</td></tr>
<tr><td class="h">1401</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;say &quot;Unable to download/verify source file(s) for $sbo:&quot;;</td></tr>
<tr><td class="h">1402</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;say &quot;&nbsp;&nbsp;$fail&quot;;</td></tr>
<tr><td class="h">1403</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print &#39;Do you want to proceed? [n] &#39;;</td></tr>
<tr><td class="h">1404</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (&lt;STDIN&gt; =~ /^[yY]/) {</td></tr>
<tr><td class="h">1405</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next FIRST;</td></tr>
<tr><td class="h">1406</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1407</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unlink for @symlinks;</td></tr>
<tr><td class="h">1408</td><td><div class="c3">1522</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return \@failures, $exit;</td></tr>
<tr><td class="h">1409</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1410</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1411</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @symlinks, @$temp_syms;</td></tr>
<tr><td class="h">1412</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1413</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1414</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $count = 0;</td></tr>
<tr><td class="h">1415</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FIRST: for my $sbo (@$todo) {</td></tr>
<tr><td class="h">1416</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$count++;</td></tr>
<tr><td class="h">1417</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $options = $$opts{$sbo} // 0;</td></tr>
<tr><td class="h">1418</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $cmds = $$cmds{$sbo} // [];</td></tr>
<tr><td class="h">1419</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for my $cmd (@$cmds) {</td></tr>
<tr><td class="h">1420</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;system($cmd) == 0 or warn &quot;\&quot;$cmd\&quot; exited non-zero\n&quot;;</td></tr>
<tr><td class="h">1421</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1422</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# switch compat32 on if upgrading/installing a -compat32</td></tr>
<tr><td class="h">1423</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# else make sure compat32 is off</td></tr>
<tr><td class="h">1424</td><td><div class="c3">1530</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $compat32 = $sbo =~ /-compat32$/ ? 1 : 0;</td></tr>
<tr><td class="h">1425</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($version, $pkg, $src, $exit) = do_slackbuild(</td></tr>
<tr><td class="h">1426</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OPTS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; $options,</td></tr>
<tr><td class="h">1427</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JOBS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; $jobs,</td></tr>
<tr><td class="h">1428</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOCATION&nbsp;&nbsp;=&gt; $$locs{$sbo},</td></tr>
<tr><td class="h">1429</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMPAT32&nbsp;&nbsp;=&gt; $compat32,</td></tr>
<tr><td class="h">1430</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">1431</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($exit) {</td></tr>
<tr><td class="h">1432</td><td><div class="c3">12240</div></td><td><div class="c3" title="T/F"><a href="SBO-Lib-lib-SBO-Lib-pm--branch.html#L1432">100</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $fail = $version;</td></tr>
<tr><td class="h">1433</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @failures, {$sbo =&gt; $fail};</td></tr>
<tr><td class="h">1434</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# return now if we&#39;re not interactive</td></tr>
<tr><td class="h">1435</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return \@failures, $exit if $args{NON_INT};</td></tr>
<tr><td class="h">1436</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# or if this is the last $sbo</td></tr>
<tr><td class="h">1437</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return \@failures, $exit if $count == @$todo;</td></tr>
<tr><td class="h">1438</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;say &quot;Failure encountered while building $sbo:&quot;;</td></tr>
<tr><td class="h">1439</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;say &quot;&nbsp;&nbsp;$fail&quot;;</td></tr>
<tr><td class="h">1440</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print &#39;Do you want to proceed [n] &#39;;</td></tr>
<tr><td class="h">1441</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (&lt;STDIN&gt; =~ /^[yY]/) {</td></tr>
<tr><td class="h">1442</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next FIRST;</td></tr>
<tr><td class="h">1443</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1444</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unlink for @symlinks;</td></tr>
<tr><td class="h">1445</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return \@failures, $exit;</td></tr>
<tr><td class="h">1446</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1447</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1448</td><td colspan="5"></td></tr><tr><td class="h">1449</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do_upgradepkg($pkg) unless $args{NOINSTALL};</td></tr>
<tr><td class="h">1450</td><td colspan="5"></td></tr><tr><td class="h">1451</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless ($args{DISTCLEAN}) {</td></tr>
<tr><td class="h">1452</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;make_clean(SBO =&gt; $sbo, SRC =&gt; $src, VERSION =&gt; $version)</td></tr>
<tr><td class="h">1453</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless $args{NOCLEAN};</td></tr>
<tr><td class="h">1454</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1455</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;make_distclean(</td></tr>
<tr><td class="h">1456</td><td><div class="c3">1530</div></td><td><div class="c0" title="T/-"><a href="SBO-Lib-lib-SBO-Lib-pm--branch.html#L1456">50</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SBO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; $sbo,</td></tr>
<tr><td class="h">1457</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SRC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; $src,</td></tr>
<tr><td class="h">1458</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VERSION&nbsp;&nbsp;&nbsp;=&gt; $version,</td></tr>
<tr><td class="h">1459</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOCATION&nbsp;&nbsp;=&gt; $$locs{$sbo},</td></tr>
<tr><td class="h">1460</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">1461</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1462</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# move package to $config{PKG_DIR} if defined</td></tr>
<tr><td class="h">1463</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless ($config{PKG_DIR} eq &#39;FALSE&#39;) {</td></tr>
<tr><td class="h">1464</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $dir = $config{PKG_DIR};</td></tr>
<tr><td class="h">1465</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless (-d $dir) {</td></tr>
<tr><td class="h">1466</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mkdir($dir) or warn &quot;Unable to create $dir\n&quot;;</td></tr>
<tr><td class="h">1467</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1468</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (-d $dir) {</td></tr>
<tr><td class="h">1469</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;move($pkg, $dir), say &quot;$pkg stored in $dir&quot;;</td></tr>
<tr><td class="h">1470</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1471</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;warn &quot;$pkg left in $tmpd\n&quot;;</td></tr>
<tr><td class="h">1472</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1473</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ($args{DISTCLEAN}) {</td></tr>
<tr><td class="h">1474</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unlink $pkg;</td></tr>
<tr><td class="h">1475</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1476</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1477</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unlink for @symlinks;</td></tr>
<tr><td class="h">1478</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return \@failures, $err;</td></tr>
<tr><td class="h">1479</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1480</td><td colspan="5"></td></tr><tr><td class="h">1481</td><td></td><td></td><td></td><td></td><td class="s"># subroutine to print out failures</td></tr>
<tr><td class="h">1482</td><td></td><td></td><td></td><td></td><td class="s">sub print_failures {</td></tr>
<tr><td class="h">1483</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $failures = shift;</td></tr>
<tr><td class="h">1484</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (@$failures &gt; 0) {</td></tr>
<tr><td class="h">1485</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;warn &quot;Failures:\n&quot;;</td></tr>
<tr><td class="h">1486</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for my $failure (@$failures) {</td></tr>
<tr><td class="h">1487</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;warn &quot;&nbsp;&nbsp;$_: $$failure{$_}&quot; for keys %$failure;</td></tr>
<tr><td class="h">1488</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1489</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1490</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1491</td><td colspan="5"></td></tr><tr><td class="h">1492</td><td></td><td></td><td></td><td></td><td class="s">&#39;ok&#39;;</td></tr>
<tr><td class="h">1493</td><td colspan="5"></td></tr></table>
</body>
</html>
